logscroll=new Object();logscroll.Pane=function(scrollContainerId){this.bottomThreshold=0;this.scrollContainerId=scrollContainerId;};logscroll.Pane.prototype.resize=function(){var scrollDiv=document.getElementById(this.scrollContainerId);scrollDiv.style.height=(document.documentElement.clientHeight-225)+'px';scrollDiv=null;this.scrollToEnd();};logscroll.Pane.prototype.scrollToEnd=function(){var scrollDiv=document.getElementById(this.scrollContainerId);scrollDiv.scrollTop=scrollDiv.scrollHeight;scrollDiv=null;};logscroll.Pane.prototype.isScrollable=function(){var scrollDiv=document.getElementById(this.scrollContainerId);var currentHeight=0;if(scrollDiv.scrollHeight>0)currentHeight=scrollDiv.scrollHeight;else if(scrollDiv.offsetHeight>0)currentHeight=scrollDiv.offsetHeight;var Result=(currentHeight-scrollDiv.scrollTop-((scrollDiv.style.pixelHeight)?scrollDiv.style.pixelHeight:scrollDiv.offsetHeight)<=this.bottomThreshold);return Result;};var InitLogRequest=undefined;var g_bFirstLogRequest=true;var g_bFirstSpyLogRequest=true;var g_bFirstChatLogRequest=true;function InitLog(sElementID,sCmd,nID){var LogWindow=document.getElementById(sElementID);if((sCmd!="")&&(InitLogRequest=createAWHttpRequest("GET",("/?Command="+sCmd+"&ID="+nID))))InitLogRequest.request();if(document.attachEvent){LogWindow.attachEvent('onmouseover',function(){document.detachEvent('onselectstart',StopSelections);document.attachEvent('onselectstart',g_fnOnSelectStart);});}else{LogWindow.addEventListener('onmouseover',function(){document.removeEventListener('selectstart',StopSelections,false);document.addEventListener('selectstart',g_fnOnSelectStart,false);},false);}if(document.attachEvent){LogWindow.attachEvent('onmouseout',function(){document.detachEvent('onselectstart',g_fnOnSelectStart);document.attachEvent('onselectstart',StopSelections);});}else{LogWindow.addEventListener('onmouseout',function(){document.removeEventListener('selectstart',g_fnOnSelectStart,false);document.addEventListener('selectstart',StopSelections,false);},false);}}function GetLog(sCmd,nID,fnCallback){var LogRequest=createXMLHttpRequest();LogRequest.open("GET",(g_sFilePath+"XML/LogTemplate.xml?Command="+sCmd+"&ID="+nID+SyncRequestParameter()),true);if(fnCallback!=undefined)LogRequest.onreadystatechange=fnCallback;if((typeof g_sEncXsrfToken!=='undefined')&&(g_sEncXsrfToken!==null)&&(g_sEncXsrfToken!==""))LogRequest.setRequestHeader("X-Csrf-Token",g_sEncXsrfToken);LogRequest.send(null);return(LogRequest);}function GetLogCategory(sLogLine){var nCategory=0;if(sLogLine.length>=4){if((sLogLine.charAt(0)=='[')&&(sLogLine.charAt(3)==']')){if(sLogLine.charAt(1)=='0')nCategory=parseInt(sLogLine.substring(2,3));else nCategory=parseInt(sLogLine.substring(1,3));}}return(nCategory);}function GetLineColor(nLogCategory){var sColor="";switch(nLogCategory){case 1:sColor="#009900;";break;case 2:sColor="#0000ff;";break;case 3:sColor="#ca6500;";break;case 4:sColor="#640986;";break;case 5:sColor="#fff;";break;case 6:sColor="#fff;";break;case 7:sColor="#fff;";break;case 8:sColor="#fff;";break;case 42:sColor="#fff;";break;default:sColor="#000000;";}if((nLogCategory>=10)&&(nLogCategory<=19))sColor+="background:#e8e8e8";else if((nLogCategory>=20)&&(nLogCategory<=29))sColor+="background:#ffffd9";else if((nLogCategory>=30)&&(nLogCategory<=39))sColor+="background:#ff6600";else if(nLogCategory==42)sColor+="background:#ff0000";else if((nLogCategory>=40)&&(nLogCategory<=49))sColor+="background:#afd9ee";else if(nLogCategory==5)sColor+="background:#ff0000";else if(nLogCategory==6)sColor+="background:#870487";else if(nLogCategory==7)sColor+="background:#000000";else if(nLogCategory==8)sColor+="background:#009933";else sColor+="background:#fff";return(sColor);}function GetSessionLineColor(nLogCategory){var sColor="#000000";if((nLogCategory % 10)==0)sColor="#009900";sColor+=";background:#fff;";return(sColor);}function OutputLogRequest(objRequest,objDivScroll,sLogID,fnLineColorCallback,bTrimCategory){var nRet=0;var bFilterLine=false;if(objRequest!=undefined){if(objRequest.readyState==4){if(objRequest.status==200){var fnGetLineColor=(fnLineColorCallback!=undefined)?fnLineColorCallback:GetLineColor;var sTempLine="";var sLines="";var xmlDoc=CreateXMLDocument(objRequest.responseText);asResponses=xmlDoc.getElementsByTagName("line");if(g_bFirstLogRequest&&sLogID=="log"){document.getElementById(sLogID).innerHTML="";g_bFirstLogRequest=false;}if(g_bFirstSpyLogRequest&&sLogID=="SpyLog"){document.getElementById(sLogID).innerHTML="";g_bFirstSpyLogRequest=false;}if(g_bFirstChatLogRequest&&sLogID=="ChatLog"){document.getElementById(sLogID).innerHTML="";g_bFirstChatLogRequest=false;}for(var nIndex=0;(nIndex<asResponses.length);nIndex++){bFilterLine=false;if(asResponses[nIndex].length!==0&&asResponses[nIndex].length!==null){var sFormatLine=DecodeString(asResponses[nIndex].childNodes[0].nodeValue);sFormatLine=encodeURIComponent(sFormatLine);sTempLine=FormatClientString(sFormatLine);if((g_sFilterLogText!="")&&(g_sFilterLogText!=undefined)){var sLCaseTempLine=sTempLine.toLowerCase();if(sLCaseTempLine.indexOf(g_sFilterLogText.toLowerCase())<0)bFilterLine=true;}if(!bFilterLine){sLines+="<div style='-moz-user-select:text;-webkit-user-select:text;color:"+fnGetLineColor(GetLogCategory(sTempLine))+";'>";if(bTrimCategory)sTempLine=sTempLine.substr(5);sTempLine=sTempLine.replace("  ","&nbsp;&nbsp;");sTempLine=sTempLine.replace("&nbsp;  ","&nbsp;&nbsp;");sLines+=sTempLine+"</div>";}}}UpdateLogFrame(objDivScroll,sLogID,sLines);nRet=1;}}else nRet=2;}return(nRet);}function UpdateLogFrame(objDivScroll,sLogID,sContent){var autoScroll=objDivScroll.isScrollable();if((sContent.length>0)&&(document.getElementById(sLogID)!=undefined))document.getElementById(sLogID).innerHTML+=sContent;if(autoScroll==true&&sContent!=""){setTimeout(function(){objDivScroll.scrollToEnd();},0);document.getElementById(objDivScroll.scrollContainerId).style.width="100%";}}function fnSelect(objId,bCopy){var bAddEvents=true;if(navigator.userAgent.toLowerCase().indexOf('firefox')!=-1)bAddEvents=false;if(bAddEvents){if(document.attachEvent){document.detachEvent('onselectstart',StopSelections);document.attachEvent('onselectstart',g_fnOnSelectStart);}else{document.removeEventListener('selectstart',StopSelections,false);document.addEventListener('selectstart',g_fnOnSelectStart,false);}}if((document.selection)||(AW.ms11)){var range=document.body.createTextRange();range.moveToElementText(document.getElementById(objId));range.select();if(((AW.ie)||(AW.ms11))&&(bCopy))range.execCommand("Copy");}else if(window.getSelection){var range=document.createRange();range.selectNode(document.getElementById(objId));window.getSelection().addRange(range);if((AW.ms11)&&(bCopy))window.clipboardData.setData('Text',range.toString());}if(bAddEvents){if(document.attachEvent){document.detachEvent('onselectstart',g_fnOnSelectStart);document.attachEvent('onselectstart',StopSelections);}else{document.removeEventListener('selectstart',g_fnOnSelectStart,false);document.addEventListener('selectstart',StopSelections,false);}}}function OnClearLog(sLogID){document.getElementById(sLogID).innerHTML="";}function OnSelectAllLog(){FreezeBox.setChecked(true,false);fnSelect('log');}