%PRIV_SYSTEM_ADMIN%
<!--#include "..\Strings\Strings.strings"-->
<!--#include "..\..\Common\Strings\Strings.strings"-->
<div class="ie6positionfix"><div class="LogHeader"><div class="LogHeader-infotxt">$SESSIONS_INFO$</div></div><div><span id="ActivityMonitor"><div class="busylist"><img src="%COMMON_FILE%Images/BusyGrid.gif" border="0"></div></span><div id="StatsGroup" style="width:100%"><div style="overflow-y : hidden;overflow : auto;width : 100%; "><table cellpadding="0" cellspacing="0" border="0" style="margin:0 0 0 10px;"><tr><td style="width: auto; min-width: 85px"><span style="white-space:nowrap;">$USER$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveUser" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_SPEED$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveSpeed" class="StatInfo"></span></td><td style="width:60px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_TIME_ON$:</span></td><td style="width:300px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveTimeOn" class="StatInfo"></span></td></tr><tr><td><span style="white-space:nowrap;">$ACTIVTY_ACCESS$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveAccess" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_AVG_DL_SPEED$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveAvgDL" class="StatInfo"></span></td><td style="width:60px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_IDLE$:</span></td><td style="width:300px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveIdle" class="StatInfo"></span></td></tr><tr valign="top"><td><span style="white-space:nowrap;">$IP_ADDRESS$:</span></td><td style="width:auto;min-width:50px;height:32px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveIP" class="StatInfo"></span></td><td style="width:90px;height:32px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_AVG_UL_SPEED$:</span></td><td style="width:auto;min-width:50px;height:32px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveAvgUL" class="StatInfo"></span></td><td style="width:60px;height:32px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_SINCE$:</span></td><td style="width:300px;height:32px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveSince" class="StatInfo"></span></td></tr><tr><td><span style="white-space:nowrap;">$ACTIVITY_DL$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveDownloaded" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$LOCATION$:</span></td><td colspan="3" style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveLocation" class="StatInfo"></span></td></tr><tr><td><span style="white-space:nowrap;">$ACTIVITY_UL$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="$DETAIL_SESSION_PREFIX$ActiveUploaded" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$LAST_COMMAND$:</span></td><td colspan="3" style="width:auto;min-width:50px;overflow:hidden;padding-left:10px;"><div style="width:0;white-space:nowrap;"><span id="$DETAIL_SESSION_PREFIX$ActiveCommand" class="StatInfo" title=""></span></div></td></tr><tr><td style="padding-top:10px; vertical-align:top;"><span id="$DETAIL_SESSION_PREFIX$Encryption-Text" style="white-space:nowrap;"></span></td><td style="width:auto;min-width:50px;padding-top:10px;padding-left:10px;vertical-align:top;"><span id="$DETAIL_SESSION_PREFIX$Encryption" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;padding-top:10px;vertical-align:top;"><span style="visibility:hidden;white-space:nowrap;" id="$DETAIL_SESSION_PREFIX$PublicKeyProtocolLabel">$SELECTED_PUBLIC_KEY_PROTOCOL$:</span></td><td colspan="3" style="width:auto;min-width:50px;padding-top:10px;overflow:hidden;padding-left:10px;vertical-align:top;"><div style="width:0;white-space:nowrap;"><span id="$DETAIL_SESSION_PREFIX$PublicKeyProtocol" class="StatInfo" title=""></span></div></td></tr></table><div style="clear:both;height:18px;overflow:hidden;"></div></div></div><div style="padding-top:5px;"><span id="KillUserButton" style="margin-right: 15px;"></span><span id="AbortButton"></span><div style="float:right;"><span id="BroadcastButton" style="margin-right: 15px;"></span><span id="SessionMessageButton"></span></div></div></div></div><div id="DisconnectDialoginner" style="display:none;"><form name="DisconnectForm" onsubmit="return (false);"><table class="DialogTable"><tr><td><span id="DisconnectActionGroup"><span id="DisconnectActionRadio"></span><span id="DisconnectMinutesContainer"><span id="DisconnectMinutes"></span><span id="DisconnectDurationLabel" style="white-space:nowrap;">$DISCONNECT_BAN_LABEL$</span></span><div style="clear:both;margin-top:5px;"><span id="DisconnectLevelLabel" style="padding:8px 5px 0 0;white-space:nowrap;"></span><span id="DisconnectLevel"></span></div></span><div style="margin-top:5px;"><span id="DisconnectDisableAct"></span></div></td><td style="text-align:right;vertical-align:top;padding-right:5px;"><span id="DisconnectButton"></span><br /><span id="CancelDisconnectButton"></span><br /><br /><span id="HelpDisconnectButton"></span></td></tr><tr><td colspan="2"><span id="DisconnectMessageLabel">$DISCONNECT_MESSAGE$:</span><div style="overflow:auto"><span id="DisconnectMessage"></span></div></td></tr></table></form></div><script type="text/javascript" language="javascript">var g_aDisconnectItems=new Array();var DisconnectMinutes,sDefLevelLabel,sDefLevel,DisconnectLevel;var DisconnectAction,DetachDisconnectMinutes,DisconnectDisableAcct,DisconnectMessage;$(document).ready(function(){BuildDialog("$DISCONNECT_DIALOG_TITLE$","DisconnectDialog","495","215","","$CLOSE_CANCEL$");CreateGroupBox("$DISCONNECT_ACTION$","DisconnectActionGroup",365,(g_bSysAdmin)?95:75,true);DisconnectMinutes=CreateInputField("15","DisconnectMinutes","DisconnectMinutes",undefined,35,12,true,OnSaveDisconnect);DisconnectMinutes.setStyle("position","relative");if(AW.ff)DisconnectMinutes.setStyle("top","-2px");else if(AW.chrome||AW.safari)DisconnectMinutes.setStyle("top","-4px");else DisconnectMinutes.setStyle("top","-3px");DisconnectMinutes.setControlSize(35,12);DisconnectMinutes.setStyle("height","12px");$("#DisconnectMinutes .aw-input-box ").css("height","12px");if(g_bSysAdmin){document.getElementById("DisconnectLevelLabel").innerHTML="$DISCONNECT_LEVEL_LABEL$";sDefLevelLabel=("$OBJECT_TYPE$"=="CDomain")?"$DISCONNECT_LEVEL_DOMAIN$":"$DISCONNECT_LEVEL_SERVER$";sDefLevel=("$OBJECT_TYPE$"=="CDomain")?"1":"0";DisconnectLevel=CreateComboBox(sDefLevelLabel,sDefLevel,["$DISCONNECT_LEVEL_SERVER$","$DISCONNECT_LEVEL_DOMAIN$"],["0","1"],"DisconnectLevel","DisconnectLevel",undefined,undefined,false,110,20,OnSaveDisconnect);}DisconnectAction=CreateRadioButtons(0,["$DISCONNECT_KICK$","$DISCONNECT_BAN$ ","$DISCONNECT_BLOCK$"],"DisconnectActionRadio","DisconnectAction",225,OnChangeDisconnectAction);if(g_bFireFox3Browser)document.getElementById("DisconnectActionRadio-box").style.height="50px";if(AW.chrome||AW.safari){document.getElementById("DisconnectActionRadio-box").style.height="55px";}DetachDisconnectMinutes=$('#DisconnectMinutesContainer').detach();DetachDisconnectMinutes.appendTo('#DisconnectActionRadio-item-1-box');DisconnectDisableAcct=CreateCheckBox("$DISCONNECT_DISABLE_ACCT$","DisconnectDisableAct","DisconnectDisableAct",false);DisconnectMessage=CreateInputField("","DisconnectMessage","DisconnectMessage",undefined,350,undefined,false,OnSaveDisconnect);CreateDialogPushButton("$OK_BUTTON$","DisconnectButton",OnSaveDisconnect);CreateDialogPushButton("$CANCEL_BUTTON$","CancelDisconnectButton",OnCancelDisconnect);CreateDialogPushButton("$HELP_BUTTON$","HelpDisconnectButton",OnDisconnectHelp);});function OnChangeDisconnectAction(anSelectedItems){DisconnectMinutes.setControlDisabled(anSelectedItems[0]!=1);if(g_bSysAdmin)DisconnectLevel.SetDisabled(anSelectedItems[0]==0);}function OnSaveDisconnect(){var nCurrentItem=g_aDisconnectItems.pop();var nItemID=ActiveSessions.getCellText((ActiveSessions.m_nNumColumns-1),nCurrentItem);if((nItemID!=undefined)&&(nItemID>0)){var sAddtlParams="",sMsg=DisconnectMessage.getControlText();var nDuration=(parseInt(DisconnectMinutes.getControlText())*(1000*60)),nAction=DisconnectAction.getSelectedItems()[0];var objRequest=null;if(nAction>0){if((nAction==1)&&((isNaN(nDuration))||(nDuration<=0))){AlertDialog("$DISCONNECT_NO_DURATION$");DisconnectMinutes.getContent("box/text").element().focus();return;}else if(nAction==2)nDuration=0;sAddtlParams+="&Ban=1&Milliseconds="+nDuration;}else sAddtlParams+="&Ban=0";if(sMsg!="")sAddtlParams+="&Message="+encodeURIComponent(sMsg);if(DisconnectDisableAcct.getControlValue())sAddtlParams+="&Disable=1";if(g_bSysAdmin)sAddtlParams+="&Level="+document.getElementById(DisconnectLevel.getContent("hidden").getId()).value;if(objRequest=createAWHttpRequest("GET",("%ADMIN_FILE%XML/Result.xml%OBJECT_COMMAND_REF%CSession."+nItemID+".Disconnect"+sAddtlParams),OnSentCommandDone)){if(!g_aDisconnectItems.length){ReplaceDialog("DisconnectDialog",g_sBusyDialog);ActiveSessions.setSelectedRows([-1]);ResetActiveSessionInfo("$DETAIL_SESSION_PREFIX$");}objRequest.request();}}}function OnShowDisconnectDialog(bDisableChat,anDisconnectItems){g_aDisconnectItems=anDisconnectItems;if(bDisableChat)DisconnectMessage.setControlText("$SEND_MESSAGE_ONLY_FTP$");else DisconnectMessage.setControlText("");DisconnectMessage.setControlDisabled(bDisableChat);document.getElementById("DisconnectMessageLabel").style.color=(bDisableChat)?"Gray":"";}function ResetDisconnectDialog(){DisconnectAction.initValue(0);DisconnectMinutes.setControlText("15");DisconnectDisableAcct.setControlValue(false);DisconnectMessage.setControlText("");if(g_bSysAdmin)DisconnectLevel.initValue(parseInt(sDefLevel));}function OnCancelDisconnect(){HideDialog('DisconnectDialog');}function OnDisconnectHelp(){LaunchHelp("Help-Domain-Server-Activity.htm","Item12_3");}</script><div id="SendMessageDialoginner" style="display:none;"><form name="SendMessageForm" onsubmit="return (false);"><table class="DialogTable"><tr><td style="vertical-align:top;"><span id="SendMessageLabel"></span><div style="overflow:auto"><span id="SendMessageText"></span></div><span id="SendMessageNote"></span></td><td style="text-align:right;vertical-align:top;padding-right:5px;"><span id="SendMessageButton"></span><span id="CancelSendMessageButton"></span><br /><br /><span id="HelpSendMessageButton"></span></td></tr></table></form></div><script type="text/javascript" language="javascript">g_aSendMessageDlgParams=new Array();var SendMessageText;$(document).ready(function(){BuildDialog("","SendMessageDialog","400","138","","$CLOSE_CANCEL$");SendMessageText=CreateInputField("","SendMessageText","SendMessageText",undefined,250,undefined,false,OnSendMessage);CreateDialogPushButton("$SEND_BUTTON$","SendMessageButton",OnSendMessage);CreateDialogPushButton("$CANCEL_BUTTON$","CancelSendMessageButton",OnCancelSendMessage);CreateDialogPushButton("$HELP_BUTTON$","HelpSendMessageButton",OnSendMessageHelp);});function OnSendMessage(){var nItemID=g_aSendMessageDlgParams[2];if((nItemID!=undefined)&&(!isNaN(nItemID))&&(nItemID>0)){var sMsg=SendMessageText.getControlText();var objRequest=null;if(sMsg==""){AlertDialog(g_aSendMessageDlgParams[4]);SendMessageText.getContent("box/text").element().focus();return;}if(objRequest=createXMLHttpRequest("GET",("%ADMIN_FILE%XML/Result.xml%OBJECT_COMMAND_REF%C"+g_aSendMessageDlgParams[1]+"."+nItemID+"."+g_aSendMessageDlgParams[3]+"&Message="+encodeURIComponent(sMsg))))objRequest.send(null);}HideDialog('SendMessageDialog');}function ResetSendMessageDialog(){SendMessageText.setControlText("");}function OnCancelSendMessage(){HideDialog('SendMessageDialog');}function OnSendMessageHelp(){if(g_bDomainNav)sExpandNode="Item16_4";else sExpandNode="Item12_3";LaunchHelp("Help-Domain-Server-Activity.htm",sExpandNode);}function OnUpdateSendMessageDialog(){if(g_aSendMessageDlgParams[0]){document.getElementById("SendMessageDialogTitleText").innerHTML="$SESSION_MESSAGE_DIALOG_TITLE$";document.getElementById("SendMessageLabel").innerHTML="$SESSION_MESSAGE_LABEL$:";document.getElementById("SendMessageNote").innerHTML="$SESSION_MESSAGE_NOTE$";}else{document.getElementById("SendMessageDialogTitleText").innerHTML="$BROADCAST_MESSAGE_DIALOG_TITLE$";document.getElementById("SendMessageLabel").innerHTML="$BROADCAST_MESSAGE_LABEL$:";document.getElementById("SendMessageNote").innerHTML="$BROADCAST_MESSAGE_NOTE$";}}</script><div id="SpyChatDialoginner" style="display:none;"><div style="margin:0 5px 0 5px;"><div style="padding-right:12px;">$SESSION_LOG$:<div id="SpyContainer" class="SpyLogScroll"><div id="SpyLog"></div></div></div><span id="ClearSessionLog"></span>&nbsp;&nbsp;<span id="CopySpyLog"></span><div id="SpyStatsGroup" style="padding-right:5px;overflow-y:auto;"><div style="overflow-y : hidden;overflow : auto;width : 100%; "><table cellpadding="0" cellspacing="0" border="0" style="margin:0 0 0 10px;"><tr><td style="width: auto; min-width: 85px"><span style="white-space:nowrap;">$USER$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveUser" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_SPEED$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveSpeed" class="StatInfo"></span></td><td style="width:60px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_TIME_ON$:</span></td><td style="width:300px;padding-left:10px;"><span id="SpyChatActiveTimeOn" class="StatInfo"></span></td></tr><tr><td><span style="white-space:nowrap;">$ACTIVTY_ACCESS$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveAccess" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_AVG_DL_SPEED$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveAvgDL" class="StatInfo"></span></td><td style="width:60px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_IDLE$:</span></td><td style="width:300px;padding-left:10px;"><span id="SpyChatActiveIdle" class="StatInfo"></span></td></tr><tr valign="top"><td><span style="white-space:nowrap;">$IP_ADDRESS$:</span></td><td style="width:auto;min-width:50px;height:32px;padding-left:10px;"><span id="SpyChatActiveIP" class="StatInfo"></span></td><td style="width:90px;height:32px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_AVG_UL_SPEED$:</span></td><td style="width:auto;min-width:50px;height:32px;padding-left:10px;"><span id="SpyChatActiveAvgUL" class="StatInfo"></span></td><td style="width:60px;height:32px;padding-left:10px;"><span style="white-space:nowrap;">$ACTIVITY_SINCE$:</span></td><td style="width:300px;height:32px;padding-left:10px;"><span id="SpyChatActiveSince" class="StatInfo"></span></td></tr><tr><td><span style="white-space:nowrap;">$ACTIVITY_DL$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveDownloaded" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$LOCATION$:</span></td><td colspan="3" style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveLocation" class="StatInfo"></span></td></tr><tr><td><span style="white-space:nowrap;">$ACTIVITY_UL$:</span></td><td style="width:auto;min-width:50px;padding-left:10px;"><span id="SpyChatActiveUploaded" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;"><span style="white-space:nowrap;">$LAST_COMMAND$:</span></td><td colspan="3" style="width:auto;min-width:50px;overflow:hidden;padding-left:10px;"><div style="width:0;white-space:nowrap;"><span id="SpyChatActiveCommand" class="StatInfo" title=""></span></div></td></tr><tr><td style="padding-top:10px; vertical-align:top;"><span id="SpyChatEncryption-Text" style="white-space:nowrap;"></span></td><td style="width:auto;min-width:50px;padding-top:10px;padding-left:10px;vertical-align:top;"><span id="SpyChatEncryption" class="StatInfo"></span></td><td style="width:90px;padding-left:10px;padding-top:10px;vertical-align:top;"><span style="visibility:hidden;white-space:nowrap;" id="SpyChatPublicKeyProtocolLabel">$SELECTED_PUBLIC_KEY_PROTOCOL$:</span></td><td colspan="3" style="width:auto;min-width:50px;padding-top:10px;overflow:hidden;padding-left:10px;vertical-align:top;"><div style="width:0;white-space:nowrap;"><span id="SpyChatPublicKeyProtocol" class="StatInfo" title=""></span></div></td></tr></table><div style="clear:both;height:18px;overflow:hidden;"></div></div></div><div id="SpyChatGroup" style="padding-right:5px; padding-top:5px;"><div id="ChatContainer" class="SpyLogScroll" style="height:110px;width:auto;margin:5px;"><div id="ChatLog"></div></div><form name="ChatForm" onsubmit="return (false);"><div style="vertical-align:baseline;"><span id="ChatMessageLabel">$SESSION_MESSAGE_LABEL$:</span><div style="overflow:auto"><span id="ChatMessage"></span> <span id="SendChatMessage"></span></div></div></form></div><div style="margin-top:5px;"><span id="OkSpyChatButton"></span>&nbsp;&nbsp;<span id="HelpSpyChatButton"></span></div></div></div><script type="text/javascript" language="javascript">var ChatMessageText,SendMessageBtn;$(document).ready(function(){BuildDialog("$SPY_CHAT_DIALOG_TITLE$","SpyChatDialog","800","622","","$CLOSE_CANCEL$");CreateGroupBox("$SPY_STATS$","SpyStatsGroup","auto","150px",true);CreateGroupBox("$SPY_CHAT$","SpyChatGroup","auto","180px",true);ChatMessageText=CreateInputField("","ChatMessage","ChatMessage",undefined,350,undefined,false,OnChatSendMessage);SendMessageBtn=CreateDialogPushButton("$SEND_BUTTON$","SendChatMessage",OnChatSendMessage);CreateDialogPushButton("$CLOSE_BUTTON$","OkSpyChatButton",OnOkSpyChat);CreateDialogPushButton("$HELP_BUTTON$","HelpSpyChatButton",OnSpyChatHelp);CreatePushButton("$CLEAR_LOG$","ClearSessionLog",OnClearLog,undefined,undefined,"SpyLog");if(AW.ie){CreatePushButton("$COPY_CLIPBOARD$","CopySpyLog",OnCopySpyLog);}InitLog("SpyLog","",0);InitLog("ChatLog","",0);});var g_SessionID=undefined;var g_SpyChatRequest=undefined;var g_tSpyChatTimer=undefined;var g_ChatDivScroll=new logscroll.Pane("ChatContainer");function OnChatSendMessage(){var sMsg=ChatMessageText.getControlText();if(sMsg!=""){var objRequest=null;if(objRequest=createXMLHttpRequest("GET",("%ADMIN_FILE%XML/Result.xml%OBJECT_COMMAND_REF%CSession."+g_SessionID+".SendMessage&Message="+encodeURIComponent(sMsg)))){objRequest.send(null);ProcessChatMessages(sMsg,FormatClientString("%CUser.%USER_ID%.LoginID%"),false);}ChatMessageText.setControlText("");ChatMessageText.getContent("box/text").element().focus();}}function OnShowSpyChatDialog(nSessionID,sSessionType){g_SessionID=nSessionID;if((g_SessionID!=undefined)&&(!isNaN(g_SessionID))&&(g_SessionID>0)){InitSessionLog("$SESSION_DISCONNECT$",sSessionType);FreezeSessionLog(false);SpyChatQueryInfo(false);}EnableDisableChat((sSessionType!="CFTPSession"),"$SEND_MESSAGE_ONLY_FTP$");}function EnableDisableChat(bDisableChat,sMessage){if(bDisableChat)document.getElementById("SpyChatGroup").style.display="none";else document.getElementById("SpyChatGroup").style.display="block";}function SpyChatQueryInfo(bAbort){g_SpyChatRequest=SessionInfoQuery(bAbort,g_SpyChatRequest,g_tSpyChatTimer,"ActiveSessionInfoChat.xml",g_SessionID,OnSpyChatSessionInfo);}function OnSpyChatSessionInfo(){if((g_SpyChatRequest!=undefined)&&(g_SpyChatRequest.readyState==4)){if((g_SpyChatRequest.status==200)&&(ProcessDetailedSessionInfo(g_SpyChatRequest.responseXML,"SpyChat"))){ProcessChatMessages(GetXMLValue(g_SpyChatRequest.responseXML,"LastSysOpMessage"),GetXMLValue(g_SpyChatRequest.responseXML,"User"),true);g_tSpyChatTimer=setTimeout("SpyChatQueryInfo()",1000);}else EnableDisableChat(true,"$SESSION_DISCONNECT$");g_SpyChatRequest=undefined;}}function ProcessChatMessages(sMessages,sSender,bIncoming){if((sMessages!=undefined)&&(sMessages!="")){var dateNow=new Date();var asMessages=new Array();var sMsgColor=(bIncoming)?"blue":"red";var sTime=dateNow.toLocaleTimeString();var sOutput="";if(sMessages.indexOf('\n')>=0)asMessages=sMessages.split('\n');else asMessages[0]=sMessages;if((sSender==undefined)||(sSender=="")){if(bIncoming)sSender="*$UNKNOWN_USER$*";else sSender="$LOCAL_ADMIN$";}for(var nIndex=0;nIndex<asMessages.length;nIndex++)sOutput+="<div style='color:"+sMsgColor+";'>["+sTime+"] "+sSender+": "+FormatClientString(asMessages[nIndex],true)+"</div>";UpdateLogFrame(g_ChatDivScroll,"ChatLog",sOutput);}}function ResetSpyChatDialog(){SpyChatQueryInfo(true);FreezeSessionLog(true);ChatMessageText.setControlText("");document.getElementById("SpyLog").innerHTML="";document.getElementById("ChatLog").innerHTML="";ResetActiveSessionInfo("SpyChat");}function OnOkSpyChat(){HideDialog('SpyChatDialog');}function OnSpyChatHelp(){if(g_bDomainNav)sExpandNode="Item16_4";else sExpandNode="Item12_3";LaunchHelp("Help-Domain-Server-Activity.htm",sExpandNode);}function OnCopySpyLog(){fnSelect('SpyLog',true);}</script><script type="text/javascript" language="JavaScript">var g_InfoRequest=undefined;var g_tInfoTimer=undefined;AW.Formats.ActivityInfo=AW.Formats.XMLString.subclass();AW.Formats.ActivityInfo.create=function(){var obj=this.prototype;var _super=this.superclass.prototype;obj.init=function(){_super.init.call(this);};obj.dataToText=function(data,Grid,nColumn,nRow){var sTemp="";if(nColumn==4){var sIP=_super.dataToText(data);if(sIP.indexOf(":")>=0)sIP="["+sIP+"]";return(sIP+":"+_super.dataToText(Grid.getCellData(11,nRow)));}else if((sTemp=Grid.getCellData(12,nRow))!="")return(_super.dataToText(data)+" ("+_super.dataToText(sTemp)+")");else return(_super.dataToText(data));};obj.dataToValue=function(data,Grid,nColumn,nRow){return(this.dataToText(data,Grid,nColumn,nRow));};};function InitActivityMonitor(sHtmlId,sXMLFile,sKillId,sMsgId,sBroadcastId,sAbortId){var Grid=CreateAdminGrid(sHtmlId,["$ID$","$CONN_TYPE$","$USER$","$IP_ADDR_OR_HOST$","$SERVER_ADDRESS$","$LOCATION$","$LAST_COMMAND$","$CLIENT_SOFTWARE$"],[65,65,90,145,95,140,120,120],sXMLFile,"sessions","session",15,OnSpyChat);Grid.m_nTimerMS=2000;Grid.setSelectionMode("multi-row");var fmtXMLString=new AW.Formats.XMLString;var fmtActivityInfo=new AW.Formats.ActivityInfo;Grid.setCellFormat([new AW.Formats.Number,fmtXMLString,fmtXMLString,fmtActivityInfo,fmtActivityInfo,fmtXMLString,fmtXMLString,fmtXMLString]);Grid.onRowClicked=function(){OnChangeActiveSession(false);};Grid.getCellImage=function(nCol,nRow){return(ActivityMonitorFormat.call(this,nCol,nRow));};var KillUserBtn;if(g_bIsDemo){KillUserBtn=CreatePushButton("$KILL_USER_BUTTON$...",sKillId,OnKillUserDisabled,undefined,undefined,undefined,undefined,"customButton-disabled");}else{KillUserBtn=CreatePushButton("$KILL_USER_BUTTON$...",sKillId,OnKillUser,undefined,undefined,undefined,undefined,"customButton");}var SpyChatBtn=CreatePushButton("$SPY_CHAT_BUTTON$...",sMsgId,OnSpyChat,undefined,undefined,undefined,undefined,"customButton");var BroadcastBtn=CreatePushButton("$BROADCAST_MESSAGE_BUTTON$...",sBroadcastId,OnBroadcastMessage,undefined,undefined,undefined,undefined,"customButton");var AbortBtn=CreatePushButton("$ABORT_BUTTON$...",sAbortId,OnAbortCommand,undefined,undefined,undefined,undefined,"customButton");ResetActiveSessionInfo("$DETAIL_SESSION_PREFIX$");return(Grid);}function ActivityMonitorFormat(nColumn,nRowIndex){var sImage="Session",sTemp="";switch(this.getCellData(10,nRowIndex)){case("CHTTPSession"):this.UpdateText(FormatBrowserClient(this.getCellText(7,nRowIndex)),7,nRowIndex);this.UpdateText((this.getCellData(8,nRowIndex)!="0")?"HTTPS":"HTTP",1,nRowIndex);break;case("CSSHSession"):this.UpdateText("SFTP",1,nRowIndex);break;case("CFTPSession"):var sType=this.getCellData(9,nRowIndex);switch(sType){case("1"):sType="FTPS (TLS)";break;case("2"):sType="FTPS (SSL)";break;default:sType="FTP";break;}this.UpdateText(sType,1,nRowIndex);break;}if(this.getCellData(13,nRowIndex)!="0")return("SessionMsg");else if(this.getCellData(8,nRowIndex)!="0")return("SessionSecure");else return("Session");}function ActivityMonitorEnableDisable(bUpdate){ActiveSessions.EnableUpdates(bUpdate);OnChangeActiveSession(bUpdate!=true);}function FormatBrowserClient(sClient){sClient=HTMLDecode(sClient);if(sClient.indexOf('/')===-1){return sClient;}var ua=sClient,version,match=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*([\d.]+)/i)||[];if(/trident/i.test(match[1])){version=/\brv[:]+([\d.]+)/g.exec(ua)||[];return'IE '+(version[1]||'');}if(match[1]==='Chrome'){version=ua.match(/\bEdg\/([\d.]+)/);if(version!=null){return'Edge '+version[1];}version=ua.match(/\bOPR\/([\d.]+)/);if(version!=null){return'Opera '+version[1];}}match=match[2]?[match[1],match[2]]:['','',''];if((version=ua.match(/version\/([\d.]+)/i))!=null){match.splice(1,1,version[1]);}return match[0]+' '+match[1];}function OnChangeActiveSession(bAbort){var anSelectedRows=ActiveSessions.getSelectedRows();if(anSelectedRows.length==1){var nItemID=ActiveSessions.getCellData(14,anSelectedRows[0]);g_InfoRequest=SessionInfoQuery(bAbort,g_InfoRequest,g_tInfoTimer,"ActiveSessionInfo.xml",nItemID,OnActiveSessionInfo);}else ResetActiveSessionInfo("$DETAIL_SESSION_PREFIX$");}function SessionInfoQuery(bAbort,httpRequest,tRequestTimer,sXMLFile,nItemID,fnCallback){clearTimeout(tRequestTimer);if(httpRequest!=undefined)httpRequest=undefined;if((!bAbort)&&(nItemID!=undefined)&&(nItemID>0)){var theDate=new Date();httpRequest=createXMLHttpRequest();httpRequest.open("GET",("%ADMIN_FILE%XML/"+sXMLFile+"&ID="+nItemID+"&sync="+theDate.getTime()),true);httpRequest.onreadystatechange=fnCallback;httpRequest.send(null);}return(httpRequest);}function OnActiveSessionInfo(){if((g_InfoRequest!=undefined)&&(g_InfoRequest.readyState==4)){if((g_InfoRequest.status==200)&&(ProcessDetailedSessionInfo(g_InfoRequest.responseXML,"$DETAIL_SESSION_PREFIX$")))g_tInfoTimer=setTimeout("OnChangeActiveSession(false)",1000);g_InfoRequest=undefined;}}function FormatUserAccess(nType){var sRet="";switch(parseInt(nType)){case(0):sRet="$ACCESS_NONE$";break;case(1):sRet="$ACCESS_DOMADMIN$";break;case(2):sRet="$ACCESS_SYSADMIN$";break;}return(sRet);}function ProcessDetailedSessionInfo(XMLDoc,sElementID){var bRet=false;var nConnTime=GetXMLValueInt(XMLDoc,"ConnectionTime");if(isNaN(nConnTime))ResetActiveSessionInfo(sElementID);else{var dateNow=new Date(),dateTemp=new Date();var sUser=new String(),sLocation=new String();if((sUser=GetXMLValue(XMLDoc,"User"))==undefined)sUser="$NOT_LOGGED_IN$";document.getElementById(sElementID+"ActiveUser").innerHTML="("+GetXMLValue(XMLDoc,"SessionNumber")+") "+sUser;document.getElementById(sElementID+"ActiveSpeed").innerHTML=FormatFileSize(GetXMLValueInt(XMLDoc,"SpeedDown")+GetXMLValueInt(XMLDoc,"SpeedUp"),true)+"/$ACTIVITY_SEC_ABBREV$";document.getElementById(sElementID+"ActiveTimeOn").innerHTML=FormatDurationString(nConnTime);dateTemp.setTime(dateNow.getTime()-nConnTime);document.getElementById(sElementID+"ActiveAccess").innerHTML=FormatUserAccess(GetXMLValue(XMLDoc,"UserType"));document.getElementById(sElementID+"ActiveAvgDL").innerHTML=FormatFileSize(GetXMLValueInt(XMLDoc,"AvgDl")*1024,true)+"/$ACTIVITY_SEC_ABBREV$";document.getElementById(sElementID+"ActiveIdle").innerHTML=FormatDurationString(GetXMLValueInt(XMLDoc,"IdleMilliseconds"));document.getElementById(sElementID+"ActiveIP").innerHTML=GetXMLValue(XMLDoc,"ClientIPAddress");document.getElementById(sElementID+"ActiveAvgUL").innerHTML=FormatFileSize(GetXMLValueInt(XMLDoc,"AvgUl")*1024,true)+"/$ACTIVITY_SEC_ABBREV$";document.getElementById(sElementID+"ActiveSince").innerHTML=dateTemp.toLocaleDateString()+"<br />"+dateTemp.toLocaleTimeString();if((sLocation=GetXMLValue(XMLDoc,"Location"))==undefined)sLocation="";document.getElementById(sElementID+"ActiveDownloaded").innerHTML=FormatFileSize(GetXMLValueInt(XMLDoc,"BytesDown"),true)+" ("+FormatXMLIntValue(XMLDoc,"FilesDown")+" $ACTIVITY_FILES$)";document.getElementById(sElementID+"ActiveLocation").innerHTML=sLocation;document.getElementById(sElementID+"Encryption").innerHTML=GetEncryptionInfo(XMLDoc,sElementID);document.getElementById(sElementID+"ActiveUploaded").innerHTML=FormatFileSize(GetXMLValueInt(XMLDoc,"BytesUp"),true)+" ("+FormatXMLIntValue(XMLDoc,"FilesUp")+" $ACTIVITY_FILES$)";document.getElementById(sElementID+"ActiveCommand").innerHTML=GetXMLValue(XMLDoc,"LastCommand");document.getElementById(sElementID+"ActiveCommand").title=GetXMLValue(XMLDoc,"LastCommand");bRet=true;}return(bRet);}function ResetActiveSessionInfo(sElementID){document.getElementById(sElementID+"ActiveUser").innerHTML="";document.getElementById(sElementID+"ActiveSpeed").innerHTML="";document.getElementById(sElementID+"ActiveTimeOn").innerHTML="";document.getElementById(sElementID+"ActiveAccess").innerHTML="";document.getElementById(sElementID+"ActiveAvgDL").innerHTML="";document.getElementById(sElementID+"ActiveIdle").innerHTML="";document.getElementById(sElementID+"ActiveIP").innerHTML="";document.getElementById(sElementID+"ActiveAvgUL").innerHTML="";document.getElementById(sElementID+"ActiveSince").innerHTML="";document.getElementById(sElementID+"ActiveDownloaded").innerHTML="";document.getElementById(sElementID+"ActiveLocation").innerHTML="";document.getElementById(sElementID+"Encryption").innerHTML="";document.getElementById(sElementID+"Encryption-Text").innerHTML="";document.getElementById(sElementID+"PublicKeyProtocolLabel").style.visibility="hidden";document.getElementById(sElementID+"PublicKeyProtocol").style.visibility="hidden";document.getElementById(sElementID+"PublicKeyProtocol").innerHTML="";document.getElementById(sElementID+"ActiveCommand").innerHTML="";document.getElementById(sElementID+"ActiveCommand").title="";document.getElementById(sElementID+"ActiveUploaded").innerHTML="";}function OnKillUser(){var anSelectedDisconnectItems=ActiveSessions.getSelectedRows().toString().split(",");var nItemID=ActiveSessions.getCellData(14,ActiveSessions.getSelectedRows()[0]);var bDisableChat=true;if(anSelectedDisconnectItems!=""&&anSelectedDisconnectItems.length>0){for(var nIndex in anSelectedDisconnectItems){var sSessionType=ActiveSessions.getCellData(10,anSelectedDisconnectItems[nIndex]);if(sSessionType=="CFTPSession"){bDisableChat=false;break;}}
OnShowDisconnectDialog(bDisableChat,anSelectedDisconnectItems);ShowDialog("DisconnectDialog",undefined,ResetDisconnectDialog);}else AlertDialog("$DISCONNECT_SELECT$");}function OnKillUserDisabled(){return true;}function OnSpyChat(){var anSelectedRows=ActiveSessions.getSelectedRows();if(anSelectedRows.length==1){var nItemID=ActiveSessions.getCellData(14,anSelectedRows[0]);if((nItemID!=undefined)&&(nItemID>0)){var sSessionType=ActiveSessions.getCellData(10,anSelectedRows[0]);ActivityMonitorEnableDisable(false);OnShowSpyChatDialog(nItemID,sSessionType);ShowDialog("SpyChatDialog",undefined,OnCloseSpyChatDialog);}else AlertDialog("$SPY_CHAT_SELECT$");}else AlertDialog("$SPY_CHAT_SELECT$");}function OnCloseSpyChatDialog(){ActivityMonitorEnableDisable(true);ResetSpyChatDialog();}function OnBroadcastMessage(){var bContainsFTP=false;for(var nIndex=0;nIndex<ActiveSessions.getRowCount();nIndex++){if(ActiveSessions.getCellData(10,nIndex)=="CFTPSession"){bContainsFTP=true;break;}}if(bContainsFTP){g_aSendMessageDlgParams=[false,"$OBJECT_TYPE$",$OBJECT_ID$,"BroadcastMessage","$BROADCAST_MESSAGE_NO_TEXT$"];OnUpdateSendMessageDialog();ShowDialog("SendMessageDialog",undefined,ResetSendMessageDialog);SendMessageText.getContent("box/text").element().focus();}else AlertDialog("$BROADCAST_NO_FTP_SESSIONS$");}function OnAbortCommand(){var anSelectedRows=ActiveSessions.getSelectedRows(),anItemIDs=[];for(var nIndex in anSelectedRows)anItemIDs[nIndex]=ActiveSessions.getCellData(14,anSelectedRows[nIndex]);if((anItemIDs[0]!=undefined)&&(anItemIDs[0]>0))ConfirmDialog("$ABORT_CONFIRM_SESSION$",OnConfirmAbort,undefined,anItemIDs);else AlertDialog("$ABORT_SELECT_ITEM$");}function OnConfirmAbort(anItemIDs){for(var nIndex in anItemIDs){var Request=createAWHttpRequest("GET",("%ADMIN_FILE%XML/Result.xml%OBJECT_COMMAND_REF%CSession."+anItemIDs[nIndex]+".Abort"+"&sync="+Math.random()),OnSentCommandDone);if(Request){ReplaceDialog(g_sConfirmDialog,g_sBusyDialog);Request.request();}}}function OnSentCommandDone(){var xmlDoc=this.getResponseXML();var nResult=0;var sResultText=GetXMLValue(xmlDoc,"ResultText");BusyDialog(false);if((nResult=GetXMLValueInt(xmlDoc,"result"))!=0){if(nResult==3)AlertDialog("$COMMAND_DENIED$");else AlertDialog(GetResultText(0,"",sResultText));}else{if(g_aDisconnectItems.length)OnSaveDisconnect();}}function GetEncryptionInfo(XMLDoc,sID){var sEncryptionInfo="";document.getElementById(sID+"PublicKeyProtocolLabel").style.visibility="hidden";document.getElementById(sID+"PublicKeyProtocol").style.visibility="hidden";document.getElementById(sID+"PublicKeyProtocol").innerHTML="";if(GetXMLValue(XMLDoc,"SSLCipherName")){if(document.getElementById("StatsGroupFS")){document.getElementById("StatsGroupFS").style.height="150px";}document.getElementById("SpyStatsGroupFS").style.height="150px";document.getElementById(sID+"Encryption-Text").innerHTML="SSL $ENCRYPTION$:";sSSLCipherName=(GetXMLValue(XMLDoc,"SSLCipherName")==""||GetXMLValue(XMLDoc,"SSLCipherName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSLCipherName");sSSLCipherVersion=(GetXMLValue(XMLDoc,"SSLCipherVersion")==""||GetXMLValue(XMLDoc,"SSLCipherVersion")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSLCipherVersion");sSSLCipherDescription=(GetXMLValue(XMLDoc,"SSLCipherDescription")==""||GetXMLValue(XMLDoc,"SSLCipherDescription")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSLCipherDescription");sSSLCipherBits=(GetXMLValue(XMLDoc,"SSLCipherBits")==""||GetXMLValue(XMLDoc,"SSLCipherBits")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSLCipherBits");sEncryptionInfo=sSSLCipherBits+"-$BITS$ "+sSSLCipherName+" ("+sSSLCipherVersion+")";}else if(GetXMLValue(XMLDoc,"SSHSCCipherName")){if(document.getElementById("StatsGroupFS")){document.getElementById("StatsGroupFS").style.height="150px";}document.getElementById("SpyStatsGroupFS").style.height="150px";document.getElementById(sID+"Encryption-Text").innerHTML="SSH $ENCRYPTION$:";sSSHSCCipherName=(GetXMLValue(XMLDoc,"SSHSCCipherName")==""||GetXMLValue(XMLDoc,"SSHSCCipherName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSHSCCipherName");sSSHCSCipherName=(GetXMLValue(XMLDoc,"SSHCSCipherName")==""||GetXMLValue(XMLDoc,"SSHCSCipherName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSHCSCipherName");sSSHSCMACName=(GetXMLValue(XMLDoc,"SSHSCMACName")==""||GetXMLValue(XMLDoc,"SSHSCMACName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSHSCMACName");sSSHCSMACName=(GetXMLValue(XMLDoc,"SSHCSMACName")==""||GetXMLValue(XMLDoc,"SSHCSMACName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSHCSMACName");sSSHSCCompressionName=(GetXMLValue(XMLDoc,"SSHSCCompressionName")==""||GetXMLValue(XMLDoc,"SSHSCCompressionName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSHSCCompressionName");sSSHCSCompressionName=(GetXMLValue(XMLDoc,"SSHCSCompressionName")==""||GetXMLValue(XMLDoc,"SSHCSCompressionName")==undefined)?"$NONE$":GetXMLValue(XMLDoc,"SSHCSCompressionName");sEncryptionInfo="$SERVER_TO_CLIENT$: "+sSSHSCCipherName+", "+sSSHSCMACName+", "+sSSHSCCompressionName+"<br>$CLIENT_TO_SERVER$: "+sSSHCSCipherName+", "+sSSHCSMACName+", "+sSSHCSCompressionName;document.getElementById(sID+"PublicKeyProtocolLabel").style.visibility="visible";document.getElementById(sID+"PublicKeyProtocol").style.visibility="visible";document.getElementById(sID+"PublicKeyProtocol").innerHTML=(GetXMLValue(XMLDoc,"SSHPublicKeyProtocol")==""||GetXMLValue(XMLDoc,"SSHPublicKeyProtocol")==undefined)?"":GetXMLValue(XMLDoc,"SSHPublicKeyProtocol");}else document.getElementById(sID+"Encryption-Text").innerHTML="";return(sEncryptionInfo);}</script><script type="text/javascript" language="JavaScript">var ActiveSessions=InitActivityMonitor("ActivityMonitor",g_sAttrLogObjectType+"ActiveSessions.xml?ID="+g_nAttrLogObjectId,"KillUserButton","SessionMessageButton","BroadcastButton","AbortButton");</script>