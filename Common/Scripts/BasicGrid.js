AW.Formats.XMLString=AW.System.Format.subclass();AW.Formats.XMLString.create=function(){var obj=this.prototype;var _super=this.superclass.prototype;obj.init=function(){_super.init.call(this);};obj.dataToText=function(data){return(FormatClientString(data));};obj.dataToValue=function(data){return(this.dataToText(data).toLowerCase());};obj.comparator=DefaultCompareDir;};function CreateBasicGrid(sHtmlId,asHeaders,anColWidths,sXMLFile,sXMLRoot,fnOnDoubleClick,bDynamicLoad){var Grid=new AW.UI.SUBasicGrid(sHtmlId,asHeaders,anColWidths);if(Grid!=undefined){if(bDynamicLoad!=true){Grid.m_XMLTable=new AW.XML.GridTable(sXMLRoot);if((typeof g_sEncXsrfToken!=='undefined')&&(g_sEncXsrfToken!==null)&&(g_sEncXsrfToken!==""))Grid.m_XMLTable.setRequestHeader("X-Csrf-Token",g_sEncXsrfToken);Grid.setCellModel(Grid.m_XMLTable);}Grid.onRowDoubleClicked=fnOnDoubleClick;Grid.refresh();if((typeof(sXMLFile)!="undefined")&&(sXMLFile!="")){Grid.setTimeout(function(){this.Update(sXMLFile,true);},0);}}return(Grid);}function SetGridLoading(Grid){var element=document.getElementById(Grid.getId());element.style.backgroundPosition="50%";element.style.backgroundRepeat="no-repeat";element.style.backgroundImage="url("+g_sImagePath+"BusyGrid.gif)";}AW.XML.GridTable=AW.XML.Table.subclass();AW.XML.GridTable.create=function(){var obj=this.prototype;var _super=this.superclass.prototype;obj.init=function(sXMLRoot){_super.init.call(this);if((typeof(sXMLRoot)!="undefined")&&(sXMLRoot!=""))this.setTable("//"+sXMLRoot);};obj.responseDef=obj.response;obj.response=function(response,bSaveRowSelections){var bProcessUpdate=true;if((this.$owner)&&(typeof(this.$owner.PreUpdate)!="undefined"))bProcessUpdate=this.$owner.PreUpdate(bSaveRowSelections);if(bProcessUpdate){this.responseDef(response);if(this.$owner.m_bFilterMode)this.$owner.FilterGrid(this.$owner.m_sSearchVal,this.$owner.m_nColPos,true,this.$owner.m_bAllowEmpty);if((this.$owner)&&(typeof(this.$owner.PostUpdate)!="undefined"))this.$owner.PostUpdate(bSaveRowSelections);}};obj.requestDef=obj.request;obj.request=function(bShowLoad){if((this.$owner)&&(bShowLoad))SetGridLoading(this.$owner);this.requestDef();};obj.setData=function(Value,nColumn,nRow){var Node=this.getNode(nColumn,nRow);Value=EncodeCharForXML(encodeURIComponent(Value));if(typeof(Node.textContent)!='undefined')Node.textContent=Value;else Node.text=Value;};obj.setURLDef=obj.setURL;obj.setURL=function(sURL){var theDate=new Date();this.setURLDef(g_sAdminXMLPath+sURL+"&sync="+theDate.getTime());};obj.selectNodes=function(sXPath,RootNode){var Nodes=new Array();if(RootNode==undefined)RootNode=this.getXML();if(typeof(document.createNSResolver)=='undefined'){var TempNodes=RootNode.selectNodes(sXPath);for(var nIndex=0;nIndex<TempNodes.length;nIndex++)Nodes[nIndex]=TempNodes[nIndex];}else{var nIndex=0;var TempNodes=this.getXML().evaluate(sXPath,RootNode,null,XPathResult.ANY_TYPE,null);var CurrentNode=TempNodes.iterateNext();while(CurrentNode){Nodes[nIndex++]=CurrentNode;CurrentNode=TempNodes.iterateNext();}}return(Nodes);};};AW.UI.SUBasicGrid=AW.UI.Grid.subclass();AW.UI.SUBasicGrid.create=function(){var obj=this.prototype;var _super=this.superclass.prototype;obj.init=function(sHtmlId,asHeaders,anColWidths){_super.init.call(this);this.setId(sHtmlId);this.setHeaderText(asHeaders);this.setColumnCount(asHeaders.length);this.setSelectionMode("multi-row");this.setSelectionMultiple(true);this.setStyle("width","100%");this.setStyle("height","297px");this.setCellTemplate(new AW.Templates.ImageText,0);this.setStyle("position","static");var aFormats=new Array();for(var nIndex=0;nIndex<anColWidths.length;nIndex++){aFormats[nIndex]=new AW.Formats.XMLString;this.setColumnWidth(parseInt(anColWidths[nIndex]),nIndex);}this.setCellFormat(aFormats);this.m_dateLastSearch=0;this.m_sSearchStr="";this.m_fnOnViewClicked=null;};obj.UpdateText=function(sText,nColumn,nRow){this.m_XMLTable.setData(sText,nColumn,nRow);this.setCellText(undefined,nColumn,nRow);};obj.Update=function(sURL,bShowLoad,bKeepState){this.ShowHideLoadingFilesMessage(true);g_bSearchView=false;this.setCellModel(this.m_XMLTable);this.m_bKeepState=(bKeepState)?true:false;this.m_XMLTable.setURL(sURL);this.m_XMLTable.request(bShowLoad);};obj.ShowHideLoadingFilesMessage=function(bShow){if(typeof jQuery!="undefined"){if($('#'+this.getId()+'Container').data("load")==true){if(bShow){$("#"+this.getId()+"-view-box-middle").css("visibility","hidden");$("#"+this.getId()).css("background-image","url("+g_sCommonPath+"Images/BusyGrid.gif)");$("#"+this.getId()).css("background-position","50% center");$("#"+this.getId()).css("background-repeat","no-repeat");}else{$("#"+this.getId()).css("background-image","none");$("#"+this.getId()+"-view-box-middle").css("visibility","visible");}}}};obj.PreUpdate=function(bSaveRowSelections){this.m_nSortCol=this.getSortColumn();this.m_sSortDir=this.getSortDirection(this.m_nSortCol);if(bSaveRowSelections)this.PreserveBasicRowState();if(typeof(this.m_fnPreUpdate)!="undefined")this.m_fnPreUpdate.call(this);this.ShowHideLoadingFilesMessage(false);return(true);};obj.PostUpdate=function(bSaveRowSelections){if(this.m_bNoVirtualMode==undefined||!this.m_bNoVirtualMode)this.setVirtualMode(this.getRowCount()>=500);if(this.m_nSortCol>=0)this.sort(this.m_nSortCol,this.m_sSortDir);if(bSaveRowSelections)this.RestoreBasicRowState();else this.ResetCurrentRow();if(typeof(this.m_fnPostUpdate)!="undefined"){this.m_fnPostUpdate.call(this);}};obj.PreserveBasicRowState=function(){var aSelectedRows=new Array();var rows=new Array();var anRowIndex=this.getRowIndices();if(this.getSelectedRows().toString()!=""&&this.getSelectedRows().toString()!="-1"){aSelectedRows=this.getSelectedRows().toString().split(",");for(i=0;i<aSelectedRows.length;i++){if(this.getCellValue(9,parseInt(aSelectedRows[i]))!=1){rows.push(this.getCellValue(0,parseInt(aSelectedRows[i])));}}}this.m_SelectedFileVals=rows;};obj.RestoreBasicRowState=function(){if(this.m_SelectedFileVals.length>0){var rows=[];anRowIndex=this.getRowIndices();nTotalSelectedFiles=this.m_SelectedFileVals.length;for(i=0;i<anRowIndex.length;i++){if(this.getCellValue(9,parseInt(anRowIndex[i]))!=1){for(x=0;x<nTotalSelectedFiles;x++){if(this.getCellValue(0,parseInt(anRowIndex[i]))==this.m_SelectedFileVals[x]){this.setRowState("selected",parseInt(anRowIndex[i]));rows.push(parseInt(anRowIndex[i]));break;}}if(rows.length==nTotalSelectedFiles)break;}}this.setSelectedRows(rows);}};obj.ResetCurrentRow=function(){this.getRowIndices()?this.setCurrentRow(this.getRowIndices()[0]):this.setCurrentRow(0);this.setScrollTop(0);};obj.setCellModelDef=obj.setCellModel;obj.setCellModel=function(model){this.setCellModelDef.call(this,model);function dataToText(i,j){var data=this.getCellData(i,j);var format=this.getCellFormat(i,j);return format?format.dataToText(data,this,i,j):data;};function dataToValue(i,j){var data=this.getCellData(i,j);var format=this.getCellFormat(i,j);return format?format.dataToValue(data,this,i,j):data;};this.setCellText(dataToText);this.setCellValue(dataToValue);};obj.onHeaderClicked=function(Event,nIndex){var anRowIndices;if((nIndex==this.getSortColumn())&&((anRowIndices=this.getRowIndices())!="")){this.setSortDirection((this.getSortDirection(nIndex)=="ascending")?"descending":"ascending",nIndex);anRowIndices.reverse();this.setRowIndices(anRowIndices);return(true);}else return(false);};obj.setEvent("onkeydown",function(event){var key=String.fromCharCode(event.keyCode||event.charCode);if(key.toUpperCase()=="A"&&event.ctrlKey&&this.getSelectionMode()=="multi-row"){this.setRowSelected(true);this.setRowState("selected");var i,rows=[],max=this.getRowCount();var bDoWebClientSelect=false;try{if(this==FilesList){bDoWebClientSelect=true;anRowIndex=FilesList.getRowIndices();max=anRowIndex.length;for(i=0;i<max;i++){if(FilesList.getCellValue(9,parseInt(anRowIndex[i]))!=1)rows.push(parseInt(anRowIndex[i]));}}}catch(e){bDoWebClientSelect=false;}if(!bDoWebClientSelect){for(i=0;i<max;i++){rows.push(i);}}this.setSelectedRows(rows);}});obj.onKeyPress=function(event){var sKey=String.fromCharCode(event.keyCode||event.charCode).toLocaleLowerCase();var dateNow=new Date().getTime();var nSortColumn=this.getSortColumn();var fmtSortCol=this.getCellFormat(nSortColumn);if((sKey!="")&&(nSortColumn>=0)&&((!fmtSortCol)||(fmtSortCol.dataToValue("&",this,nSortColumn,0)!="0"))){var anIndices=this.getRowIndices();var nStartSearch=0,nCurrentRow=this.getCurrentRow();var bFound=false;var sTemp="";if(nCurrentRow>=0){for(var nIndex in anIndices){if(anIndices[nIndex]==nCurrentRow){nStartSearch=parseInt(nIndex);break;}}}if((dateNow-this.m_dateLastSearch)>750){this.m_sSearchStr=sKey;if(nStartSearch)nStartSearch++;}else this.m_sSearchStr+=sKey;this.m_dateLastSearch=dateNow;if((!this.ItemSearch(this.m_sSearchStr,nSortColumn,anIndices,nStartSearch,this.getRowCount()))&&(nStartSearch>0))this.ItemSearch(this.m_sSearchStr,nSortColumn,anIndices,0,nStartSearch);}else{this.m_sSearchStr="";this.m_dateLastSearch=0;}};obj.ItemSearch=function(sSearchStr,nSortColumn,anIndices,nStart,nStop){var bFound=false;for(var nIndex=nStart;nIndex<nStop;nIndex++){var sTemp=this.getCellText(nSortColumn,anIndices[nIndex]).substring(0,sSearchStr.length).toLocaleLowerCase();if(sTemp==sSearchStr){this.setSelectedRows([anIndices[nIndex]]);this.setCurrentRow(anIndices[nIndex]);bFound=true;break;}}return(bFound);};obj.getPageUpRow=function(){var nScrollingHeight=parseInt(parseInt(document.getElementById(this.getId()).offsetHeight)/parseInt(this.getRowHeight())-1);var i=this.getCurrentRow();var p=Math.max(this.getRowPosition(i)-nScrollingHeight,this.getRowOffset());var a=this.getRowIndices();return a?a[p]:p;};obj.getPageDownRow=function(){var nScrollingHeight=parseInt(parseInt(document.getElementById(this.getId()).offsetHeight)/parseInt(this.getRowHeight())-1);var i=this.getCurrentRow();var p=Math.min(this.getRowPosition(i)+nScrollingHeight,this.getRowOffset()+this.getRowCount()-1);var a=this.getRowIndices();return a?a[p]:p;};obj.FilterGrid=function(sSearchVal,nColPos,bFilterMode,bAllowEmpty){var i,rows=[];this.m_bFilterMode=bFilterMode;this.m_OriginalRowCount=this.m_XMLTable.getCount();this.m_sSearchVal=sSearchVal;this.m_nColPos=nColPos;this.m_bAllowEmpty=(bAllowEmpty==undefined)?false:bAllowEmpty;var sSearchWord="";var bWildCard=false;var nFileNameLength;var nSearchWordLength;var nWildCardPos,nDisAllowWildCardPos;var bDualWildCard=false;sSearchWord=sSearchVal.toLowerCase();nSearchWordLength=sSearchWord.length;nWildCardPos=sSearchWord.indexOf("*");nDisAllowWildCardPos=sSearchWord.indexOf("^");if(nWildCardPos!=-1||nDisAllowWildCardPos!=-1){bWildCard=true;}var nBracketedWord=sSearchWord.match(eval("/\\[\\b[a-zA-Z0-9_]+\\b\]/g"));var nBracketedLength=-1;if(nBracketedWord){nBracketedLength=sSearchWord.replace(eval("/\\[\\b[a-zA-Z0-9_]+\\b\]/g"),"1").length;}if(nBracketedLength>-1){nSearchWordLength=nBracketedLength;}sSearchWord=sSearchWord.replace(eval("/\\./g"),"\\.");sSearchWord=sSearchWord.replace(eval("/\\*/g"),"(.*)");sSearchWord=sSearchWord.replace(eval("/\\_/g"),"\\_");sSearchWord=sSearchWord.replace(eval("/\\?/g"),".");for(i=0;i<this.m_OriginalRowCount;i++){sTargetColValue=HTMLDecode(this.getCellValue(nColPos,i));b_WildCard=false;var bSearchMatch=false;if(sTargetColValue.toLowerCase().search(eval("/"+sSearchWord+"/"))==0){if(bWildCard)bSearchMatch=true;else if(sTargetColValue.length==nSearchWordLength)bSearchMatch=true;}if(bAllowEmpty&&(sTargetColValue==""||sTargetColValue==undefined))bSearchMatch=true;if(bSearchMatch||sSearchWord=="")rows.push(i);}this.setRowCount(rows.length);this.setRowIndices(rows);};obj.GetHitTestOnView=function(bIsVerticalTest,nMouseLocX,nMouseLocY,sVisibleScrollbar){var bRet=false;var sID=this.getId();var rParent=document.getElementById(sID).parentNode;if(rParent!=undefined&&rParent!=null){var rectContainer=rParent.getBoundingClientRect();var nHeaderCount=this.getHeaderCount();var nOverallHeaderHeight=0;for(nIdx=0;nIdx<nHeaderCount;nIdx++)nOverallHeaderHeight+=this.getHeaderHeight(nIdx);var nBottomSideOfLastHeader=(rectContainer.top+nOverallHeaderHeight);if(nMouseLocY>nBottomSideOfLastHeader){if(bIsVerticalTest){var nHorzScrollbarHeight=0;if(sVisibleScrollbar=="horizontal")nHorzScrollbarHeight=18;var nNumOfRows=this.getRowCount(0);var nRowHeight=this.getRowHeight(0);var nOverallRowHeight=(nNumOfRows*nRowHeight);var nBottomSideOfLastRow=(rectContainer.top+(nOverallHeaderHeight+nOverallRowHeight));var nBottomSideOfContainer=(rectContainer.bottom-nHorzScrollbarHeight);if(nMouseLocY>nBottomSideOfLastRow&&nMouseLocY<nBottomSideOfContainer){if(this.m_fnOnViewClicked!=undefined&&this.m_fnOnViewClicked!=null)this.m_fnOnViewClicked(nMouseLocX,nMouseLocY);bRet=true;}}else{var nVertScrollbarWidth=0;if(sVisibleScrollbar=="vertical")nVertScrollbarWidth=18;var nNumOfCols=this.getColumnCount();var nOverallColWidth=0;for(nIdx=0;nIdx<nNumOfCols;nIdx++)nOverallColWidth+=this.getColumnWidth(nIdx);var nRightSideOfLastRow=(rectContainer.left+nOverallColWidth);var nRightSideOfContainer=(rectContainer.right-nVertScrollbarWidth);if(nMouseLocX>nRightSideOfLastRow&&nMouseLocX<nRightSideOfContainer){if(this.m_fnOnViewClicked!=undefined&&this.m_fnOnViewClicked!=null)this.m_fnOnViewClicked(nMouseLocX,nMouseLocY);bRet=true;}}}}return(bRet);};obj.setEvent("onmousedown",function(event){var sScrollBars=this.getScrollBars();if(sScrollBars!=undefined&&sScrollBars!=null){sScrollBars=sScrollBars.toLowerCase();if(sScrollBars=="vertical")this.GetHitTestOnView(false,event.clientX,event.clientY,sScrollBars);else if(sScrollBars=="horizontal")this.GetHitTestOnView(true,event.clientX,event.clientY,sScrollBars);else if(sScrollBars=="none"){if(!this.GetHitTestOnView(true,event.clientX,event.clientY,sScrollBars))this.GetHitTestOnView(false,event.clientX,event.clientY,sScrollBars);}}});};function DefaultCompareDir(values,greater,less,equal,error){return(function(i,j){try{var a=values[i];var b=values[j];var bIsNum=false;var nCompareResult;if(isNaN(a)&&isNaN(b)){a=a.toLocaleLowerCase();b=b.toLocaleLowerCase();nCompareResult=a.localeCompare(b);}else bIsNum=true;if(!bIsNum){if(nCompareResult>0){return greater}if(nCompareResult<0){return less}return equal(i,j);}else{if(a>b){return greater}if(a<b){return less}return equal(i,j);}}catch(e){return error(i,j,e);}});}