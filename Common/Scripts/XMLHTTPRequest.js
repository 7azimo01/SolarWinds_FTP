var g_nNOOPFSRetry=0;var g_bSetAjaxGlobals=true;function AjaxRequest(){this.url;this.requestHeaders={};this.urlParams={};this.postParams={};if(g_bSetAjaxGlobals){g_bSetAjaxGlobals=false;$.ajaxSetup({headers:{"X-User-Agent":navigator.userAgent },beforeSend:function(jqXHR,settings){var sUrl=settings.url;if(sUrl.indexOf("Sync")<0){var CurrentDate=new Date();var sSyncStr="Sync="+CurrentDate.getTime();if(sUrl.indexOf('?')<0)sUrl+="?"+sSyncStr;else sUrl+="&"+sSyncStr;}this.url=settings.url=sUrl;}});}this.SetRequestHeader=function(sHeader,sValue){this.requestHeaders[sHeader]=sValue;};this.SetUrlParameter=function(sUrlParam,sValue){this.urlParams[sUrlParam]=sValue;};this.SetPostParameter=function(sPostParam,sValue){this.postParams[sPostParam]=sValue;};this.CompileParameterString=function(objects){var sRet="";if(objects!=undefined&&objects!=null){var bSkipFirstOne=true;for(var sKey in objects){if(bSkipFirstOne)bSkipFirstOne=false;else sRet+="&";sRet+=sKey+"="+encodeURIComponent(objects[sKey]);}}return(sRet);};this.CompileUrlWithQueryString=function(sURL){var url=sURL;var sQueryStr=this.CompileParameterString(this.urlParams);if(sQueryStr.length>0){var nFoundAt=url.indexOf("?");if(nFoundAt>-1)url=url.substr(0,nFoundAt);url+="?"+sQueryStr;}return(url);};this.SendRequest=function(sType,sURL,fnCallback,objCallbackData,objData,bProcessData){if(sType==undefined)var sType="GET";if(objData==undefined)var objData=null;if(bProcessData==undefined)var bProcessData=true;$.ajax({url:sURL,dataType:"xml",type:sType,processData:bProcessData,data:objData,headers:this.requestHeaders,beforeSend:function(xhr){if((typeof g_sEncXsrfToken!=='undefined')&&(g_sEncXsrfToken!==null)&&(g_sEncXsrfToken!==""))xhr.setRequestHeader('X-CSRF-Token',g_sEncXsrfToken);}}).done(function(data,textStatus,jqXHR){if(fnCallback!=undefined&&fnCallback!=null)fnCallback(data,textStatus,jqXHR,objCallbackData);});};this.Get=function(sURL,fnCallback,objCallbackData,bManuallyProcessData){var data=this.urlParams;var bAllowAjaxToProcessData=true;if(bManuallyProcessData!=undefined&&bManuallyProcessData){data=this.CompileParameterString(this.urlParams);bAllowAjaxToProcessData=false;}this.SendRequest("GET",sURL,fnCallback,objCallbackData,data,bAllowAjaxToProcessData);};this.Post=function(sURL,fnCallback,objCallbackData,bManuallyProcessData){this.SetRequestHeader("Content-Type","application/x-www-form-urlencoded");var data=this.postParams;var bAllowAjaxToProcessData=true;if(bManuallyProcessData!=undefined&&bManuallyProcessData){data=this.CompileParameterString(this.postParams);bAllowAjaxToProcessData=false;}var url=this.CompileUrlWithQueryString(sURL);this.SendRequest("POST",url,fnCallback,objCallbackData,data,bAllowAjaxToProcessData);};this.PostData=function(sURL,objPostData,fnCallback,objCallbackData){this.SetRequestHeader("Content-Type","application/x-www-form-urlencoded");var url=this.CompileUrlWithQueryString(sURL);this.SendRequest("POST",url,fnCallback,objCallbackData,objPostData,false);};}function createXMLHttpRequest(sMethod,sURL,fnCallback,objCallbackData){var objRequest=null;try{objRequest=new XMLHttpRequest();}catch(e){AlertDialog(g_sAjaxNotSupported,true);}if(objRequest){if(sMethod&&sURL){objRequest.open(sMethod,sURL+SyncRequestParameter(),true);if(sMethod.toUpperCase()=="POST"){objRequest.setRequestHeader("Content-Type","application/x-www-form-urlencoded");objRequest.setRequestHeader("X-User-Agent",escape(navigator.userAgent));if((typeof g_sEncXsrfToken!=='undefined')&&(g_sEncXsrfToken!==null)&&(g_sEncXsrfToken!==""))objRequest.setRequestHeader('X-CSRF-Token',g_sEncXsrfToken);}}if(fnCallback)objRequest.onreadystatechange=function(){fnCallback(this,objCallbackData);};}return(objRequest);}function FormatXMLIntValue(xmlDoc,sNode){var sRet=GetXMLValue(xmlDoc,sNode);if(sRet){var nIndex=-1;sRet=parseInt(sRet).toLocaleString();if((((nVal=sRet.lastIndexOf('.'))>0)||((nVal=sRet.lastIndexOf(','))>0))&&(sRet.substr(nVal+1)=="00"))sRet=sRet.substr(0,nVal);}return(sRet);}function OnNOOPResponse(objRequest){if(objRequest!=undefined&&objRequest.readyState==4){var nNOOPDelay=55000;if(g_bFVJVLoggedInCheck)nNOOPDelay=10000;if(objRequest.status==200){var XMLDoc=objRequest.responseXML;var nResult=GetXMLValueInt(XMLDoc,"result");if(nResult!=g_nSessionOkay&&g_nNOOPFSRetry>=5){var sResultText=GetXMLValue(XMLDoc,"ResultText");if(sResultText==""||sResultText==undefined)sResultText=g_sUnknownError;AlertDialogEx(sResultText,true,undefined,undefined,undefined,undefined,false);}else{if(nResult!=g_nSessionOkay){g_nNOOPFSRetry++;nNOOPDelay=0;}else g_nNOOPFSRetry=0;setTimeout("SendXMLHTTPNOOP()",nNOOPDelay);}}else{if(g_nNOOPFSRetry>=5){var sErr=g_sFailedCmdNOOP;sErr=sErr.replace("$HttpCode",objRequest.status);AlertDialog(sErr);}else{g_nNOOPFSRetry++;setTimeout("SendXMLHTTPNOOP()",0);}}}}function SendXMLHTTPNOOP(){var sNOOPCmd="/?Command=NOOP";var objXMLHTTPNOOPRequest=createXMLHttpRequest("POST",sNOOPCmd,OnNOOPResponse);objXMLHTTPNOOPRequest.send(null);}