function CreateAdminGrid(sHtmlId,asHeaders,anColWidths,sXMLFile,sXMLRoot,sXMLDataName,nNumColumns,fnOnDoubleClick,bSuppressSortCol,bNoVirtualMode){var Grid=new AW.UI.SUAdminGrid(sHtmlId,asHeaders,anColWidths,bSuppressSortCol,bNoVirtualMode);if(Grid!=undefined){Grid.m_XMLTable=new AW.XML.GridTable(sXMLRoot);Grid.setCellModel(Grid.m_XMLTable);Grid.m_sXMLFile=Grid.m_sOrigXMLFile=sXMLFile;Grid.m_sDataNodeName=sXMLDataName;Grid.m_nNumColumns=nNumColumns;Grid.onRowDoubleClicked=fnOnDoubleClick;Grid.m_nDeleteColumn=(nNumColumns-1);Grid.m_nIDCol=Grid.m_nDeleteColumn;Grid.m_sIDCol="ID";Grid.m_ColumnNoResize=[];Grid.setEvent("oncontextmenu","return false");Grid.refresh();SetGridLoading(Grid);}return(Grid);}function ClearGrid(Grid,bLoading){Grid.Reset(bLoading);}function OnObjectMoveTop(Grid){Grid.MoveObject(g_sAdminXMLPath+"Result.xml?Command=MoveTopObject&Object");}function OnObjectMoveUp(Grid){Grid.MoveObject(g_sAdminXMLPath+"Result.xml?Command=MoveUpObject&Object");}function OnObjectMoveDown(Grid){Grid.MoveObject(g_sAdminXMLPath+"Result.xml?Command=MoveDownObject&Object");}function OnObjectMoveBottom(Grid){Grid.MoveObject(g_sAdminXMLPath+"Result.xml?Command=MoveBottomObject&Object");}AW.UI.SUAdminGrid=AW.UI.SUBasicGrid.subclass();AW.UI.SUAdminGrid.create=function(){var obj=this.prototype;var _super=this.superclass.prototype;obj.init=function(sHtmlId,asHeaders,anColWidths,nLoadSortCol,bNoVirtualmode){_super.init.call(this,sHtmlId,asHeaders,anColWidths);var nDefaultCol=0;if(nLoadSortCol!=undefined)nDefaultCol=nLoadSortCol;this.setSortColumn(nDefaultCol);this.setSortDirection("ascending",nDefaultCol);this.m_nEditObjectID=-1;this.m_bInitialUpdate=true;this.m_nTimerMS=1000;this.m_DisableMove=false;this.m_bFilterMode=false;this.m_bAllowEmpty=false;this.m_bNoVirtualMode=(bNoVirtualmode)?true:false;};obj.NoResizeColumns=function(anGridColsNoResize){this.m_ColumnNoResize=anGridColsNoResize;};obj.RightAlignColumn=function(nColumn,bHeader){var RightAlignTemplate=new AW.Templates.Text;RightAlignTemplate.setStyle("text-align","right");this.setCellTemplate(RightAlignTemplate,nColumn);if(bHeader)this.getHeaderTemplate(nColumn).setStyle("text-align","right");};obj.ChangeURL=function(sURL){this.m_sXMLFile=this.m_sOrigXMLFile=sURL;};obj.EnableUpdates=function(bEnable,sFmtStr,sNewVal,bReplaceOrigURL){var nTimeoutVal=1000;if((sFmtStr!=undefined)&&(sNewVal!=undefined))this.m_sXMLFile=this.m_sOrigXMLFile.replace(sFmtStr,sNewVal);if(bReplaceOrigURL)this.m_sOrigXMLFile=this.m_sXMLFile;if((bEnable)&&(!this.m_bUpdates))this.m_nTimeout=this.setTimeout(this.TimeoutFunc,nTimeoutVal);else if(!bEnable)clearTimeout(this.m_nTimeout);this.m_bUpdates=bEnable;};obj.TimeoutFunc=function(){var sAddtlParams=(this.m_bInitialUpdate)?"&ForceList=1":"";this.m_XMLTable.setURL(this.m_sXMLFile+sAddtlParams);this.m_XMLTable.request();};obj.ForceUpdate=function(sFmtStr,sNewVal){this.m_bForceUpdate=true;if((sFmtStr!=undefined)&&(sNewVal!=undefined))this.m_sXMLFile=this.m_sOrigXMLFile.replace(sFmtStr,sNewVal);this.TimeoutFunc();};obj.PreUpdateDef=obj.PreUpdate;obj.PreUpdate=function(){var bRet=true;var nListResult=GetXMLValue(this.m_XMLTable.getResponseXML(),"listresult");this.PreUpdateDef();if(!((this.m_bUpdates)||(this.m_bForceUpdate)))bRet=false;else if((this.m_XMLTable.getCount()==1)&&(this.m_XMLTable.getResponseText()=="")){this.setTimeout(this.ForceUpdate,0);bRet=false;}else if((nListResult!=undefined)&&(nListResult!=0)){if(nListResult==800)this.ResetTimer();bRet=false;}else this.PreserveRowState();this.m_bUpdating=bRet;return(bRet);};obj.PostUpdateDef=obj.PostUpdate;obj.PostUpdate=function(){this.RestoreRowState();this.PostUpdateDef();if(this.m_bSaving)LoadingDialog(this.m_bSaving=false);this.m_bInitialUpdate=false;this.ResetTimer();this.m_bUpdating=false;};obj.PreserveRowState=function(){this.m_nCurrentObj=(this.getCurrentRow()>=0)?this.getCellData(this.m_nIDCol,this.getCurrentRow()):-1;this.m_nScrollLeft=this.getScrollLeft();this.m_nScrollTop=this.getScrollTop();if(((this.m_anSelectedObjects=this.getSelectedRows()).length)&&(this.m_anSelectedObjects[0]!=-1)){for(var nIndex=0;nIndex<this.m_anSelectedObjects.length;nIndex++)this.m_anSelectedObjects[nIndex]=this.getCellData(this.m_nIDCol,this.m_anSelectedObjects[nIndex]);}else this.m_anSelectedObjects=undefined;};obj.RestoreRowState=function(){var aSelRows=new Array();this.m_bRestoredCurrent=false;if((this.m_anSelectedObjects!=undefined)&&(this.m_anSelectedObjects.length)){for(var nIndex=0;nIndex<this.m_anSelectedObjects.length;nIndex++){var RowNode;var aNodes=this.m_XMLTable.selectNodes("//"+this.m_sDataNodeName+"["+this.m_sIDCol+"='"+this.m_anSelectedObjects[nIndex]+"']");if((aNodes.length==1)&&((RowNode=this.m_XMLTable.selectNodes("./@listitem",aNodes[0])).length==1)){var nRow=((typeof(RowNode[0].textContent)!='undefined'))?parseInt(RowNode[0].textContent):parseInt(RowNode[0].text);this.setRowSelected(true,nRow);aSelRows.push(nRow);if(this.m_anSelectedObjects[nIndex]==this.m_nCurrentObj){this.setCurrentRow(nRow);this.m_nCurrentObj=-1;this.m_bRestoredCurrent=true;}}}this.setSelectedRows(aSelRows);this.m_anSelectedObjects=undefined;}};obj.ResetCurrentRowDef=obj.ResetCurrentRow;obj.ResetCurrentRow=function(){this.setTimeout(this.ResetCurrentRowTimeout,0);};obj.ResetCurrentRowTimeout=function(){this.setScrollLeft(this.m_nScrollLeft);this.setScrollTop(this.m_nScrollTop);this.m_nScrollLeft=this.m_nScrollTop=0;};obj.ResetTimer=function(){if((!this.m_bForceUpdate)&&(this.m_bUpdates))this.m_nTimeout=this.setTimeout(this.TimeoutFunc,this.m_nTimerMS);else this.m_bForceUpdate=false;};obj.EditObject=function(sLoadURL,nID,bPost,sSaveURL,Form,sDialog,afnCallbacks,bCheckErrorState,FocusElement,bBypassId,bHideLoadingDialog){var ObjectTable=new AW.XML.SUObjectTable(sLoadURL,nID);if(ObjectTable!=undefined){if(bPost)ObjectTable.setRequestMethod("POST");if(afnCallbacks!=undefined){if((afnCallbacks.length>=1)&&(afnCallbacks[0]!=undefined)){this.m_fnOnFillFormCallback=afnCallbacks[0];ObjectTable.m_fnOnFillForm=this.OnFillFormCallback;ObjectTable.m_OnFillFormObj=this;}if((afnCallbacks.length>=2)&&(afnCallbacks[1]!=undefined))ObjectTable.m_fnDialogDismissal=afnCallbacks[1];}if((bCheckErrorState!=undefined)&&(bCheckErrorState)){this.m_fnOnFillFormCallback=this.CheckErrorState;ObjectTable.m_fnOnFillForm=this.OnFillFormCallback;ObjectTable.m_OnFillFormObj=this;ObjectTable.m_bCheckError=true;}ObjectTable.FillForm(Form,sDialog,FocusElement,bHideLoadingDialog);}this.m_nEditObjectID=nID;this.m_sDialog=sDialog;this.m_Form=Form;this.m_sSaveURL=sSaveURL;};obj.OnFillFormCallback=function(Grid,ObjectTable){Grid.UpdateEditObjectID(Grid,ObjectTable);if(Grid.m_fnOnFillFormCallback!=undefined)Grid.m_fnOnFillFormCallback(Grid,ObjectTable);};obj.UpdateEditObjectID=function(Grid,ObjectTable){var aNodes=ObjectTable.GetCollectionByAttrib("var","name","ObjectID");if((aNodes!=undefined)&&(aNodes.length>0)){var sValue=ObjectTable.GetNodeValue(aNodes[0],"val");if(sValue!=undefined){var nID=parseInt(sValue);Grid.m_nEditObjectID=nID;if(Grid.m_sSaveURL.charAt(Grid.m_sSaveURL.length-1)=='.')Grid.m_sSaveURL+=nID;}}};obj.OnSaveObject=function(fnCompleteCallback,bShowSaving,fnSaveFailCallback){var ObjectTable=new AW.XML.SUObjectTable(this.m_sSaveURL,((this.m_bNewObject)?-1:((this.m_bTempEdit)?this.m_nOriginalEditID:this.m_nEditObjectID)));if(ObjectTable!=undefined)ObjectTable.SubmitForm(this.m_Form,this.m_sDialog,fnCompleteCallback,bShowSaving,fnSaveFailCallback);};obj.OnAddObject=function(sLoadURL,sSaveURL,Form,sDialog,afnCallbacks,bCheckErrorState,FocusElement,bHideLoadingDialog){this.m_bNewObject=true;this.EditObject(sLoadURL,0,true,sSaveURL,Form,sDialog,afnCallbacks,bCheckErrorState,FocusElement,undefined,bHideLoadingDialog);};obj.OnEditObject=function(sLoadURL,sSaveURL,Form,sDialog,sSelectOnlyOneMessage,sSelectOneMessage,afnCallbacks,bUseTemp,nObjectID,FocusElement,bBypassId,bHideLoadingDialog){if(!nObjectID){if((this.getSelectedRows()!="")&&(this.getSelectedRows()!=-1)){var EditCells=new Array();EditCells=this.getSelectedRows().toString().split(",");if(EditCells.length==1)nObjectID=parseInt(this.getCellData((this.m_nNumColumns-1),EditCells[0]));else{if(bHideLoadingDialog)LoadingDialog(false);WarnDialog(sSelectOnlyOneMessage);}}else{if(bHideLoadingDialog)LoadingDialog(false);WarnDialog(sSelectOneMessage);}}if(nObjectID){var nID=-1;this.m_bNewObject=false;this.m_nOriginalEditID=nObjectID;if(bUseTemp)sLoadURL+=this.m_nOriginalEditID;else{nID=this.m_nOriginalEditID;if(bBypassId==undefined||!bBypassId)sSaveURL+=nID;}this.m_bTempEdit=bUseTemp;this.EditObject(sLoadURL,nID,false,sSaveURL,Form,sDialog,afnCallbacks,undefined,FocusElement,bBypassId,bHideLoadingDialog);}};obj.OnCopyObject=function(sLoadURL,sSaveURL,Form,sDialog,sSelectOnlyOneMessage,sSelectOneMessage,afnCallbacks,bUseTemp,nObjectID){if(!nObjectID){if((this.getSelectedRows()!="")&&(this.getSelectedRows()!=-1)){var EditCells=new Array();EditCells=this.getSelectedRows().toString().split(",");if(EditCells.length==1)nObjectID=parseInt(this.getCellData((this.m_nNumColumns-1),EditCells[0]));else WarnDialog(sSelectOnlyOneMessage);}else WarnDialog(sSelectOneMessage);}if(nObjectID){var nID=-1;this.m_bNewObject=true;this.m_nOriginalEditID=nObjectID;if(bUseTemp)sLoadURL+=this.m_nOriginalEditID;else{nID=this.m_nOriginalEditID;sSaveURL+=nID;}this.m_bTempEdit=bUseTemp;this.EditObject(sLoadURL,-1,false,sSaveURL,Form,sDialog,afnCallbacks);}};obj.DeleteSelectedObjects=function(Grid,bNoConfirm){var IDs=new Array();var DeleteCells=new Array();var sAlternateErrorTxt=this.m_sAltErrText;var sPostParamName="IDs";DeleteCells=this.getSelectedRows().toString().split(",");if(this.m_sParamName!=undefined&&this.m_sParamName!="")sPostParamName=this.m_sParamName;for(var nIndex=0;(nIndex<DeleteCells.length);nIndex++){var nID=this.getCellValue(this.m_nDeleteColumn,DeleteCells[nIndex]);IDs.push(nID);}var DeleteRequest=CreatePostRequest(this.m_sDeleteURL);DeleteRequest.setParameter(sPostParamName,IDs);DeleteRequest.response=function(){var xmlDoc=this.getResponseXML();var nResult=GetXMLValueInt(xmlDoc,"result");var sResultText=GetXMLValue(xmlDoc,"ResultText");DeletingDialog(false);if((nResult!=undefined)&&(nResult!=g_nSessionOkay))AlertDialog(GetResultText(nResult,sAlternateErrorTxt,sResultText));if(Grid.m_fnOnDeleteDone!=undefined){Grid.m_fnOnDeleteDone(nResult,IDs);Grid.m_fnOnDeleteDone=undefined;}};DeleteRequest.request(null);if(bNoConfirm)DeletingDialog(true);else{SetupBusyDialog(g_sDeletingDialogTitle);ReplaceDialog(g_sConfirmDialog,g_sBusyDialog);}this.setSelectedRows([-1]);};obj.OnDeleteObjects=function(Grid,bNoConfirm){if(Grid.m_fnOnConfirmDelete!=undefined){Grid.m_fnOnConfirmDelete();Grid.m_fnOnConfirmDelete=undefined;}Grid.DeleteSelectedObjects(Grid,bNoConfirm);};obj.OnDeleteObject=function(sDeleteURL,sConfirmMessage,sSelectOneMessage,fnOnDeleteDone,fnOnConfirmDelete,fnOnNoConfirmDelete,sAltErrText,sParamName){if((this.getSelectedRows()!="")&&(this.getSelectedRows()!=-1)){var DeleteCells=new Array();DeleteCells=this.getSelectedRows().toString().split(",");if(DeleteCells.length>0){this.m_sDeleteURL=g_sAdminXMLPath+sDeleteURL;this.m_sAltErrText=sAltErrText;this.m_fnOnConfirmDelete=fnOnConfirmDelete;this.m_fnOnDeleteDone=fnOnDeleteDone;if(sParamName!=undefined&&sParamName!="")this.m_sParamName=sParamName;else this.m_sParamName=undefined;if(sConfirmMessage!=undefined)ConfirmDialog(sConfirmMessage,this.OnDeleteObjects,fnOnNoConfirmDelete,this,undefined,undefined,true);else this.OnDeleteObjects(this,true);}else WarnDialog(sSelectOneMessage);}else WarnDialog(sSelectOneMessage);};obj.InitObjectMove=function(anButtonIds,sMoveStr,fnOnGetEditObj){CreateRuleButtons(anButtonIds,[OnObjectMoveTop,OnObjectMoveUp,OnObjectMoveDown,OnObjectMoveBottom],this);this.m_asArrowIds=anButtonIds;this.m_sMoveStr=sMoveStr;this.m_fnOnGetEditObj=fnOnGetEditObj;this.onSelectedRowsChanged([]);};obj.MoveObject=function(sCommand){var anSelectedRows=this.getSelectedRows();var sObjMoveStr=this.m_sMoveStr;if((sObjMoveStr.search(eval("/\\$EDIT_OBJECT_ID\\$/"))>=0)&&(this.m_fnOnGetEditObj!=undefined))sObjMoveStr=sObjMoveStr.replace(eval("/\\$EDIT_OBJECT_ID\\$/"),this.m_fnOnGetEditObj());if(anSelectedRows.length==1){var nItemID=this.GetSelectedObjectID();if(nItemID>0){var objRequest=CreatePostRequest(sCommand+"="+sObjMoveStr+"."+nItemID);SavingDialog(true);this.m_bSaving=true;objRequest.response=function(){var nResult=OnSaveComplete(this,true);var sResultText=OnGetResultText(this);if(nResult!=g_nSessionOkay){SavingDialog(false);this.m_bSaving=false;AlertDialog(GetResultText(0,"",sResultText));}};if(objRequest)objRequest.request();}}};obj.onSelectedRowsChanged=function(anSelectedRows){if(this.m_asArrowIds!=undefined){var asStates=[true,true];if((anSelectedRows.length==1)&&(anSelectedRows[0]!=-1)&&!this.m_DisableMove){if(anSelectedRows[0]!=0)asStates[0]=false;if(anSelectedRows[0]!=(this.getRowCount()-1))asStates[1]=false;}if(asStates[0]){$("#"+"btn-"+this.m_asArrowIds[0]+",#"+"btn-"+this.m_asArrowIds[1]).attr("disabled",true);$("#"+"btn-"+this.m_asArrowIds[0]+",#"+"btn-"+this.m_asArrowIds[1]).addClass("button_disabled");}else{$("#"+"btn-"+this.m_asArrowIds[0]+",#"+"btn-"+this.m_asArrowIds[1]).removeAttr("disabled");$("#"+"btn-"+this.m_asArrowIds[0]+",#"+"btn-"+this.m_asArrowIds[1]).removeClass("button_disabled");}if(asStates[1]){$("#"+"btn-"+this.m_asArrowIds[2]+",#"+"btn-"+this.m_asArrowIds[3]).attr("disabled",true);$("#"+"btn-"+this.m_asArrowIds[2]+",#"+"btn-"+this.m_asArrowIds[3]).addClass("button_disabled");}else{$("#"+"btn-"+this.m_asArrowIds[2]+",#"+"btn-"+this.m_asArrowIds[3]).removeAttr("disabled");$("#"+"btn-"+this.m_asArrowIds[2]+",#"+"btn-"+this.m_asArrowIds[3]).removeClass("button_disabled");}}};obj.GetObjectID=function(sText,nColumn){var nRet=0;for(var nIndex=0;nIndex<this.getRowCount();nIndex++){if(this.getCellText(nColumn,nIndex)==sText){nRet=parseInt(this.getCellText((this.m_nNumColumns-1),nIndex));break;}}return(nRet);};obj.GetSelectedObjectID=function(){var anSelectedRows=this.getSelectedRows();var nRet=-1;if(anSelectedRows.length)nRet=parseInt(this.getCellText((this.m_nNumColumns-1),anSelectedRows[0]));return(nRet);};obj.DisableSorting=function(fnCallback){this.m_DisableMove=false;if(this.onHeaderClickedDef==undefined)this.onHeaderClickedDef=this.onHeaderClicked;if(fnCallback!=undefined)this.onHeaderClicked=function(Event,nIndex){fnCallback(nIndex);};else this.onHeaderClicked=function(Event,nIndex){return(true);};this.setSortColumn(-1);};obj.EnableSorting=function(){this.m_DisableMove=true;this.onSelectedRowsChanged(-1);this.onHeaderClicked=this.onHeaderClickedDef;this.setSortColumn(1);};obj.Reset=function(bLoading){var SelectionMode=this.getSelectionMode();var aCellFmts=[];for(var nIndex=0;nIndex<(this.m_nNumColumns-1);nIndex++)aCellFmts[nIndex]=this.getCellFormat(nIndex);this.saveColSortColumn=this.getSortColumn();this.saveSortDirection=this.getSortDirection(this.getSortColumn());this.clearCurrentModel();this.clearRowModel();this.clearScrollModel();this.clearSelectionModel();this.clearSortModel();this.setSelectionMode(SelectionMode);this.setCellFormat(aCellFmts);this.m_bInitialUpdate=true;this.refresh();if(bLoading)SetGridLoading(this);};obj.clearScrollModelDef=obj.clearScrollModel;obj.clearScrollModel=function(){if(!this.m_bUpdating)this.clearScrollModelDef();};obj.CheckErrorState=function(Grid,XMLTable){var aNodes=[];var aNodesResultTxt=[];var sVal="";var sResultTextVal="";if((aNodes=XMLTable.GetCollectionByAttrib("var","name","Result"))&&(aNodes.length)&&((sVal=XMLTable.GetNodeValue(aNodes[0],"val"))!="0")){aNodesResultTxt=XMLTable.GetCollectionByAttrib("var","name","ResultText");sResultTextVal=XMLTable.GetNodeValue(aNodesResultTxt[0],"val");HideDialog(this.m_sDialog);AlertDialog(GetResultText(0,"",sResultTextVal),true);}};};