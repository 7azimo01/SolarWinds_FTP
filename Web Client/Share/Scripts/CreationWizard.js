var NUM_OF_UPLOAD_FILES_TO_ADD=5;var g_nNumOfUploadItems=NUM_OF_UPLOAD_FILES_TO_ADD;var m_sPrevAutoExpireDateTime="";var WIZARD_ERR_GENERIC=0;var WIZARD_ERR_EMAIL_LINK_IS_ON_WITH_NO_GUESTS=1;var m_nWizardError=WIZARD_ERR_GENERIC;function TurnOnErrorForRecipients(){TurnOnErrorStates([$("#recipientEmailsLabel"),$("#RcpEmailsDiv").find("ul.tagit")]);}function TurnOffErrorForRecipients(){TurnOffErrorStates([$("#recipientEmailsLabel"),$("#RcpEmailsDiv").find("ul.tagit")]);}function TurnOnErrorForEmailSubject(){TurnOnErrorStates([$("#senderEmailSubject"),$("#senderEmailSubjectLabel")]);}function TurnOffErrorForEmailSubject(){TurnOffErrorStates([$("#senderEmailSubject"),$("#senderEmailSubjectLabel")]);}function TurnOnErrorForEmailBody(){TurnOnErrorStates([$("#EmailBody"),$("#EmailBodyLabel")]);}function TurnOffErrorForEmailBody(){TurnOffErrorStates([$("#EmailBody"),$("#EmailBodyLabel")]);}function TurnOnErrorForName(){TurnOnErrorStates([$("#senderName"),$("#senderNameLabel")]);}function TurnOffErrorForName(){TurnOffErrorStates([$("#senderName"),$("#senderNameLabel")]);}function TurnOnErrorForEmailAddr(){TurnOnErrorStates([$("#senderEmail"),$("#senderEmailLabel")]);}function TurnOffErrorForEmailAddr(){TurnOffErrorStates([$("#senderEmail"),$("#senderEmailLabel")]);}function AreValidRecipients(bAutoEmailLinkIsOn){var bIsValid=true;var sEmails=$("#recipientEmails").val();if(sEmails!=null&&sEmails!=undefined&&sEmails!=""){var asEmailArray=sEmails.split(';');for(var nPos=0;(nPos<asEmailArray.length&&bIsValid);nPos++){bIsValid=IsValidEmailAddressString(asEmailArray[nPos]);}}else{if(bAutoEmailLinkIsOn){bIsValid=false;m_nWizardError=WIZARD_ERR_EMAIL_LINK_IS_ON_WITH_NO_GUESTS;}}if(!bIsValid)TurnOnErrorForRecipients();else TurnOffErrorForRecipients();return(bIsValid);}function IsValidSenderName(bCanTurnOnError){var bIsValid=(!IsEmptyValue($("#senderName")));if(typeof(bCanTurnOnError)!="undefined"&&bCanTurnOnError!=undefined&&bCanTurnOnError!=null&&bCanTurnOnError){if(!bIsValid)TurnOnErrorForName();else TurnOffErrorForName();}else TurnOffErrorForName();return(bIsValid);}function IsValidSenderEmail(bCanTurnOnError){var bIsValid=true;if((!IsEmptyValue($("#senderEmail")))||(GetCheckedState("NotifyUserOnGuestTransfers"))||(GetCheckedState("EmailAfterUpload"))){bIsValid=IsValidEmailAddressString($("#senderEmail").val());}if(typeof(bCanTurnOnError)!="undefined"&&bCanTurnOnError!=undefined&&bCanTurnOnError!=null&&bCanTurnOnError){if(!bIsValid)TurnOnErrorForEmailAddr();else TurnOffErrorForEmailAddr();}else TurnOffErrorForEmailAddr();return(bIsValid);}function IsValidEmailSubject(bCanTurnOnError){var bIsValid=(!IsEmptyValue($("#senderEmailSubject")));if(typeof(bCanTurnOnError)!="undefined"&&bCanTurnOnError!=undefined&&bCanTurnOnError!=null&&bCanTurnOnError){if(!bIsValid)TurnOnErrorForEmailSubject();else TurnOffErrorForEmailSubject();}else TurnOffErrorForEmailSubject();return(bIsValid);}function IsValidEmailMsg(bCanTurnOnError){return(true);}function IsValidExpirationDate(){var bIsValid=true;var dtDate=GetLinkExpirationDate(false);if(dtDate!=null&&dtDate!=undefined){if(dtDate instanceof Date){var lTimestamp=dtDate.getTime();if(lTimestamp!=DATE_MAX_MILLIS&&lTimestamp<g_dtPageLoadDate.getTime())bIsValid=false;}}else bIsValid=false;if(!bIsValid)TurnOnErrorState($("#ExpiresOnDateLabel"));else TurnOffErrorState($("#ExpiresOnDateLabel"));return(bIsValid);}function OnClickLinkExpireRadio(objRadioBtn){TurnOffErrorState($("#ExpiresOnDateLabel"));UpdateEmailSubject();}function FillSelectorWithDays(nMaxDays){FillSelectorWithOptions(nMaxDays,$("#ExpiresInDaysSel"));document.getElementById("ExpiresInDaysSel").selectedIndex=(nMaxDays-1);}function FillSelectorWithHours(){FillSelectorWithOptions(MAX_HOURS,$("#ExpiresInHoursSel"));document.getElementById("ExpiresInHoursSel").selectedIndex=(MAX_HOURS-1);}function OnChangeExpiresInDays(){TurnOffErrorState($("#ExpiresOnDateLabel"));$("#ExpiresInDays").trigger("click");}function OnChangeExpiresInHours(){TurnOffErrorState($("#ExpiresOnDateLabel"));$("#ExpiresInHours").trigger("click");}function OnChangeExpiresDateTime(){$("#ExpiresOnDate").trigger("click");}function ShowFormError(sError,oElement,oTab,nIndex){if((oTab!=undefined)&&(nIndex!=undefined))oTab.tabs("select",nIndex);AlertDialog(sError,false,function(){setTimeout(function(){if(oElement!=undefined)oElement.focus();});});}function ValidateEmailAddresses(event){if(($(this).is(":visible"))&&(this.value.length)){var sEmailFilter=eval("/^([A-Za-z0-9_\\s\\-\\.])+\\@([A-Za-z0-9_\\-\\.])+\\.([A-Za-z]{2,63})$/");var $element=$(this);$.each(this.value.split(","),function(nIndex,sVal){$.each(sVal.split(";"),function(nIndex2,sEmailAddress){var nAtPos=sEmailAddress.indexOf("@");if((sEmailAddress.length)&&((parseInt(sEmailAddress.indexOf("..",nAtPos))>-1)||(!sEmailFilter.test(sEmailAddress)))){ShowFormError(event.data.sErrMsg,$element);event.stopImmediatePropagation();event.preventDefault();}});});}}function GetLinkExpirationDate(bShowPageError){if(!g_bAllowUserDefinedGuestAccess&&g_ullRestrictGuestAccessDays==0)return(new Date(DATE_MAX_MILLIS));var dtLinkExpiresDate=null;var sSelectedRadio=$('input[name=linkExpires]:checked').val();var nSelectedOpt=parseInt(sSelectedRadio);switch(nSelectedOpt){case 0:{var dtSpan=new Date(0);var nNumberOfDays=document.getElementById("ExpiresInDaysSel").selectedIndex+1;dtSpan.setTime(NumberOfDaysToMillis(nNumberOfDays));dtLinkExpiresDate=new Date(g_dtPageLoadDate.getTime()+dtSpan.getTime());}break;case 1:{var dtSpan=new Date(0);var nNumberOfHours=document.getElementById("ExpiresInHoursSel").selectedIndex+1;dtSpan.setTime(NumberOfHoursToMillis(nNumberOfHours));dtLinkExpiresDate=new Date(g_dtPageLoadDate.getTime()+dtSpan.getTime());}break;case 2:{var dtDate=$("#ExpiresOnDatePicker").datepicker("getDate");if(dtDate!=null&&dtDate!=undefined){if(dtDate instanceof Date)dtLinkExpiresDate=dtDate;}}break;case 3:{dtLinkExpiresDate=new Date(DATE_MAX_MILLIS);}break;default:{}break;}if(dtLinkExpiresDate==null&&bShowPageError){ASSERT("GetLinkExpirationDate: Programming error, expiration date does not exist.");}return(dtLinkExpiresDate);}function UpdateEmailSubject(){var sFmtExpirationDateTime="";var dtExpirationDate=GetLinkExpirationDate(true);if(dtExpirationDate!=null){if(dtExpirationDate.getTime()==DATE_MAX_MILLIS)sFmtExpirationDateTime=IDS_NEVER;else sFmtExpirationDateTime=toLocaleShortDateTimeString(dtExpirationDate.getTime());}var sCurEmailSubject=decodeURIComponent($("#senderEmailSubject").val());if(sCurEmailSubject==undefined||sCurEmailSubject==null||sCurEmailSubject==""){if(g_sEmailSubject!="")sCurEmailSubject=g_sEmailSubject.replace("$FileShareExpires",sFmtExpirationDateTime);else sCurEmailSubject=IDS_EMAIL_SUBJECT_HEAD+" ["+IDS_EXPIRES+" "+sFmtExpirationDateTime+"]";}else{var nFoundAt=-1;if(sCurEmailSubject!=undefined&&sCurEmailSubject!=null&&m_sPrevAutoExpireDateTime!=undefined&&m_sPrevAutoExpireDateTime!=null&&m_sPrevAutoExpireDateTime!="")nFoundAt=sCurEmailSubject.indexOf(m_sPrevAutoExpireDateTime);if(nFoundAt>-1)sCurEmailSubject=sCurEmailSubject.replace(m_sPrevAutoExpireDateTime,sFmtExpirationDateTime);}m_sPrevAutoExpireDateTime=sFmtExpirationDateTime;if(sCurEmailSubject!=decodeURIComponent($("#senderEmailSubject").val()))$("#senderEmailSubject").val(sCurEmailSubject);}function OnEmailAfterUpload(){UpdateEmailAfterUploadControls();}function UpdateEmailAfterUploadControls(){var bIsChecked=GetCheckedState("EmailAfterUpload");if(g_nSendAccessLinkToSender==0){var aDisabledElements=["CCToSender"];SetElementDisabledState(aDisabledElements,(!bIsChecked));}}function AddSummaryNote(sText){var rListObj=document.getElementById('UploadConfirmNotes');if(rListObj!=undefined&&rListObj!=null&&sText!=null&&sText!=undefined&&sText!=""){var rLI=document.createElement("li");rLI.className="ListItemFile";rLI.innerHTML=sText;rListObj.appendChild(rLI);}}function CreateFileShare(sReqFilePath,sShareType,sRecipientEmailAddresses,sSenderName,sSenderEmail,sNotifyUserOnGuestTransfer,sSenderCarbonCopy,sEmailSubject,sEmailBody,sExpirationTimestamp,sPasswordIsSet,sPassword,sIncludePasswordInEmail,sMaxFileSize,fnOnResponse){var request=new AjaxRequest();request.SetUrlParameter("Command","CreateFileShare");request.SetPostParameter("ShareType",sShareType);request.SetPostParameter("RecipientEmailAddresses",Trim(sRecipientEmailAddresses));request.SetPostParameter("SenderName",Trim(sSenderName));request.SetPostParameter("SenderEmail",Trim(sSenderEmail));request.SetPostParameter("NotifyUserOnGuestTransfer",sNotifyUserOnGuestTransfer);request.SetPostParameter("SenderCarbonCopy",sSenderCarbonCopy);request.SetPostParameter("EmailSubject",Trim(sEmailSubject));request.SetPostParameter("EmailBody",Trim(sEmailBody));request.SetPostParameter("ExpirationTimestamp",sExpirationTimestamp);request.SetPostParameter("PasswordIsSet",sPasswordIsSet);request.SetPostParameter("Password",sPassword);request.SetPostParameter("IncludePasswordInEmail",sIncludePasswordInEmail);request.SetPostParameter("MaxFileSize",sMaxFileSize);request.Post(sReqFilePath,fnOnResponse);}function GetLinkExpirationDateIfEnabled(){var sExpires=null;var dtExpirationDate=GetLinkExpirationDate(false);if(dtExpirationDate!=null&&dtExpirationDate!=undefined){if(dtExpirationDate instanceof Date){if(dtExpirationDate.getTime()!=DATE_MAX_MILLIS)sExpires=toLocaleShortDateTimeString(dtExpirationDate.getTime());}}return(sExpires);}function CheckOptionalLimit(nLimitValue,asDisableIDs,sCheckBoxID,sBadgeID){if(nLimitValue!=0){SetElementDisabledState(asDisableIDs,true);if(nLimitValue==1)$("#"+sCheckBoxID).prop("checked",true);else $("#"+sCheckBoxID).prop("checked",false);$("#"+sBadgeID).css("display","inline-block");}}function CanEmailAfterUpload(){var bCanEmailAfterUpload=false;if((g_nSendAccessLinkToRecipients==1)||(g_nSendAccessLinkToRecipients==0&&GetCheckedState("EmailAfterUpload")))bCanEmailAfterUpload=true;return(bCanEmailAfterUpload);}function GetRecipients(sUndisclosedRecipientsTxt){var sRecipients=$("#recipientEmails").val();if(sRecipients==undefined||sRecipients==null||sRecipients==""||sRecipients==sUndisclosedRecipientsTxt)sRecipients=sUndisclosedRecipientsTxt.toLowerCase();return(sRecipients);}function GetSummaryDescEx(bEmailWasSent,sUndisclosedRecipientsTxt,sDescSentEmail,sDescNoRecipients,sDescNoRecipientsIncPword,sDescManuallySendEmail,sDescManuallySendEmailIncPword){var sDesc;if((GetCheckedState("EmailAfterUpload"))&&(bEmailWasSent)){sDesc=sDescSentEmail;sDesc=sDesc.replace("$Recipients",GetRecipients(sUndisclosedRecipientsTxt));}else{var sRecipients=$("#recipientEmails").val();if(sRecipients==null||sRecipients==undefined||sRecipients==""){if(GetCheckedState("addPwordToFileShare")){sDesc=sDescNoRecipientsIncPword;sDesc=sDesc.replace("$Password",$("#FileSharePword").val());}else sDesc=sDescNoRecipients;}else{if(GetCheckedState("addPwordToFileShare")){sDesc=sDescManuallySendEmailIncPword;sDesc=sDesc.replace("$Password",$("#FileSharePword").val());}else sDesc=sDescManuallySendEmail;}}var sExpires=IDS_FILE_SHARE_DOES_NOT_EXPIRE;var sLinkExpirationDate=GetLinkExpirationDateIfEnabled();if(sLinkExpirationDate!=null&&sLinkExpirationDate!=undefined)sExpires=sLinkExpirationDate;sDesc=sDesc.replace("$AdhocShareExpires",sExpires);return(sDesc);}function GetMaximumDaysToExpireLink(){var nMaximumDaysToExpireLink=g_ullRestrictGuestAccessDays;if(nMaximumDaysToExpireLink==0){var dtNow=new Date();var dtMax=new Date(DATE_MAX*1000);var nNumOfMillisFromToday=(dtMax.getTime()-dtNow.getTime());nMaximumDaysToExpireLink=parseInt((((nNumOfMillisFromToday/1000)/60)/60)/24);}return(nMaximumDaysToExpireLink);}function GetDefaultDaysToExpireLink(nMaximumDaysToExpireLink){var nDaysToExpireLink=NUM_OF_DAYS_TO_EXPIRE_GUEST_ACCESS;if((!g_bAllowUserDefinedGuestAccess)||(nDaysToExpireLink>nMaximumDaysToExpireLink))nDaysToExpireLink=nMaximumDaysToExpireLink;return(nDaysToExpireLink);}function GetMaxDaysDefaultForExpireCombo(){var nMaxDays=MAX_DAYS;if((g_ullRestrictGuestAccessDays!=0)&&(nMaxDays>g_ullRestrictGuestAccessDays))nMaxDays=g_ullRestrictGuestAccessDays;return(nMaxDays);}